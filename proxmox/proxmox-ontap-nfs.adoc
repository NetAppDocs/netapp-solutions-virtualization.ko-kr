---
sidebar: sidebar 
permalink: proxmox/proxmox-ontap-nfs.html 
keywords: netapp, proxmox, proxmox ve, nfs, ontap, storage, nconnect, session trunking 
summary: ONTAP 사용하여 Proxmox 가상 환경에 대한 NFS 스토리지를 구성합니다. 이 절차에는 SVM 활성화, LIF 생성, 내보내기 정책 구성, 볼륨 생성, 그리고 내결함성 및 성능 향상을 위한 nConnect 또는 세션 트렁킹 설정이 포함됩니다. 
---
= Proxmox VE용 NFS 스토리지를 구성합니다.
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
NetApp ONTAP 사용하여 Proxmox 가상 환경(VE)용 NFS 스토리지를 구성합니다. 스토리지 시스템에 대한 여러 네트워크 연결에서 내결함성과 성능 향상을 위해 NFS v4.1 이상에서 세션 트렁킹을 사용하십시오.

ONTAP Proxmox VE에서 지원하는 모든 NFS 버전을 지원합니다. 사용 link:https://docs.netapp.com/us-en/ontap/nfs-trunking/index.html["세션 트렁킹"] 내결함성 및 성능 향상을 위해서입니다. 세션 트렁킹을 사용하려면 NFS v4.1 이상이 필요합니다.

ONTAP 처음 사용하는 경우 시스템 관리자 인터페이스를 사용하여 이러한 작업을 완료하십시오.

.ONTAP 사용한 NFS nconnect 옵션
video::f6c9aba3-b070-45d6-8048-b22e001acfd4[panopto,width=360]


== 스토리지 관리자 작업

Proxmox VE에서 사용할 ONTAP 의 NFS 스토리지를 프로비저닝하려면 다음 작업을 완료하십시오.

. NFS용 SVM을 활성화하세요. 참조하다 link:https://docs.netapp.com/us-en/ontap/nfs-config/verify-protocol-enabled-svm-task.html["ONTAP 9 문서"].
. 컨트롤러당 최소 2개의 LIF를 생성하십시오. 설명서에 나와 있는 단계를 따르십시오. 참고로, 실험실에서 사용되는 LIF의 스크린샷을 첨부합니다.
+
.예를 보여주세요
[%collapsible]
====
image:proxmox-ontap-nfs-001.png["NAS 인터페이스 세부 정보"]

====
. Proxmox VE 호스트 IP 주소 또는 서브넷에 대한 액세스를 제공하도록 NFS 내보내기 정책을 생성하거나 업데이트합니다. 참조하다 link:https://docs.netapp.com/us-en/ontap/nfs-config/create-export-policy-task.html["수출 정책 생성"] 그리고 link:https://docs.netapp.com/us-en/ontap/nfs-config/add-rule-export-policy-task.html["내보내기 정책에 규칙 추가"].
. link:https://docs.netapp.com/us-en/ontap/nfs-config/create-volume-task.html["볼륨을 생성합니다"]. 대용량(>100TB)이 필요한 경우 FlexGroup 사용하여 클러스터 전체에 데이터를 분산하는 옵션을 확인하십시오. FlexGroup 사용하는 경우, 성능 향상을 위해 SVM에서 pNFS를 활성화하는 것을 고려해 보세요. 자세한 내용은 다음 단계를 따르세요. link:https://docs.netapp.com/us-en/ontap/pnfs/pnfs-commands.html#enable-nfsv4-1["SVM에서 pNFS를 활성화합니다."]. pNFS를 사용할 때는 Proxmox VE 호스트가 모든 컨트롤러(데이터 LIF)에 데이터에 접근할 수 있도록 해야 합니다. 해당 볼륨에서 랜섬웨어 방지 기능이 활성화되어 있는지 확인하십시오.
+
.예를 보여주세요
[%collapsible]
====
image:proxmox-ontap-nfs-002.png["FlexGroup 옵션"]

====
. link:https://docs.netapp.com/us-en/ontap/nfs-config/associate-export-policy-flexvol-task.html["볼륨에 내보내기 정책을 할당합니다."].
+
.예를 보여주세요
[%collapsible]
====
image:proxmox-ontap-nfs-003.png["NFS 볼륨 정보"]

====
. 가상화 관리자에게 NFS 볼륨이 준비되었음을 알리십시오.




== 가상화 관리자 작업

Proxmox VE에 NFS 볼륨을 스토리지로 추가하고 성능 향상을 위해 nConnect 또는 세션 트렁킹을 구성하려면 다음 작업을 완료하십시오.

. 장애 복구를 위해 최소 두 개의 인터페이스가 서로 다른 VLAN에 구성되어 있는지 확인하십시오. NIC 본딩을 사용하십시오.
. 관리 UI를 사용하여 `https:<proxmox-node>:8006`데이터센터를 클릭하고 스토리지를 선택한 다음 추가를 클릭하고 NFS를 선택합니다.
+
.예를 보여주세요
[%collapsible]
====
image:proxmox-ontap-nfs-004.png["NFS 스토리지 탐색"]

====
. 세부 정보를 입력하세요. 서버 정보를 제공하면 NFS 내보내기 목록이 표시됩니다. 목록에서 선택하고 콘텐츠 옵션을 고르세요.
+
.예를 보여주세요
[%collapsible]
====
image:proxmox-ontap-nfs-005.png["NFS 스토리지 추가"]

====
. nConnect 옵션을 활성화하려면 클러스터 노드에서 셸을 열고 다음 명령을 실행하십시오. `<storage id>` 이전 단계에서 생성된 스토리지 ID입니다.
+
[source, shell]
----
pvesm set <storage id> --options nconnect=4
----
+
세션 트렁킹을 사용하려면 NFS v4.1을 사용하고 trunkdiscovery 및 max_connect 옵션을 설정해야 합니다.

+
[source, shell]
----
pvesm set <storage id> --options vers=4.1,trunkdiscovery,max_connect=16
----
. 다음은 구성된 스토리지에 대한 /etc/pve/storage.cfg 파일의 내용입니다.
+
.예를 보여주세요
[%collapsible]
====
image:proxmox-ontap-nfs-006.png["NFS용 스토리지 구성 파일"]

====
. nConnect 옵션이 설정되었는지 확인하려면 다음 명령을 실행하세요. `ss -an | grep :2049` Proxmox VE 호스트에서 NFS 서버 IP에 대한 다중 연결이 있는지 확인하십시오. pNFS가 활성화되었는지 확인하려면 다음 명령을 실행하세요. `nfsstat -c` 레이아웃 관련 지표를 확인하세요. 데이터 트래픽을 기반으로 데이터 LIF에 대한 여러 연결이 표시되어야 합니다.



NOTE: 세션 트렁킹에서 nconnect 옵션은 트렁크 인터페이스 중 하나에만 설정됩니다. pNFS에서는 메타데이터 및 데이터 인터페이스에 nconnect 옵션이 설정됩니다. 실제 운영 환경에서는 nConnect 또는 세션 트렁킹 중 하나만 사용하고 둘 다 사용하지 마십시오.
