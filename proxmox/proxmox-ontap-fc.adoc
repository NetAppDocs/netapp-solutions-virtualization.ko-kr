---
sidebar: sidebar 
permalink: proxmox/proxmox-ontap-fc.html 
keywords: netapp, proxmox, proxmox ve, fc, fibre channel, lvm, ontap, storage 
summary: 'ONTAP 사용하여 Proxmox 가상 환경에 파이버 채널을 지원하는 LVM(논리 볼륨 관리자)을 구성합니다. 이 절차에는 멀티패스 구성, LUN 프로비저닝, iGroup 설정 및 공유 스토리지용 볼륨 그룹 생성이 포함됩니다.' 
---
= Proxmox VE용 FC를 사용하여 LVM 구성
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
NetApp ONTAP 사용하여 파이버 채널 프로토콜로 Proxmox 가상 환경(VE) 호스트 간의 공유 스토리지를 위해 논리 볼륨 관리자(LVM)를 구성합니다. 이 구성은 고성능 및 낮은 지연 시간으로 블록 수준 스토리지 액세스를 가능하게 합니다.



== 초기 가상화 관리자 작업

FC 연결을 위해 Proxmox VE 호스트를 준비하려면 다음 초기 작업을 완료하고 스토리지 관리자에게 필요한 정보를 수집하십시오.

. 두 개의 HBA 인터페이스가 사용 가능한지 확인하십시오.
. multipath-tools가 모든 Proxmox VE 호스트에 설치되어 있고 부팅 시 자동으로 시작되는지 확인하십시오.
+
[source, shell]
----
apt list | grep multipath-tools
# If need to install, execute the following line.
apt-get install multipath-tools
systemctl enable --now multipathd
----
+

NOTE: ONTAP 장치 다중 경로에 대한 원하는 구성이 패키지에 이미 포함되어 있습니다. 자세한 내용은 link:https://docs.netapp.com/us-en/ontap-sanhost/hu-proxmox-ve-9x.html#step-1-confirm-the-multipath-configuration-for-your-host["ONTAP 스토리지를 사용한 FCP 및 iSCSI용 Proxmox VE 9.x의 ONTAP 9 문서"]을 참조하십시오.

. 모든 Proxmox VE 호스트의 WWPN을 수집하여 스토리지 관리자에게 제공하십시오.
+
[source, shell]
----
cat /sys/class/fc_host/host*/port_name
----




== 스토리지 관리자 작업

ONTAP 처음 사용하시는 경우, 시스템 관리자를 이용하시면 더욱 편리하게 사용하실 수 있습니다.

. SVM이 FC 프로토콜이 활성화된 상태로 사용 가능한지 확인하십시오. 따르다 link:https://docs.netapp.com/us-en/ontap/san-admin/provision-storage.html["ONTAP 9 문서"].
. FC 전용으로 컨트롤러당 두 개의 LIF를 생성합니다.
+
image:proxmox-ontap-fc-001.png["FC 인터페이스 세부 정보"]

. igroup을 생성하고 호스트 FC 이니시에이터를 채웁니다.
. 원하는 크기의 LUN을 SVM에 생성하고 이전 단계에서 생성한 igroup에 제공합니다. ASA 시스템의 경우 보안 탭에서, AFF/ FAS 시스템의 경우 볼륨 보안 탭에서 랜섬웨어 방지 기능이 활성화되어 있는지 확인하십시오.
+
image:proxmox-ontap-fc-002.png["달의 세부 정보"]

. LUN이 생성되었음을 가상화 관리자에게 알리십시오.




== 가상화 관리자 최종 작업

Proxmox VE에서 LUN을 공유 LVM 스토리지로 구성하려면 다음 작업을 완료하십시오.

. 클러스터에 있는 각 Proxmox VE 호스트의 셸로 이동하여 디스크가 보이는지 확인하십시오.
+
[source, shell]
----
lsblk -S
rescan-scsi-bus.sh
lsblk -S
----
. 장치가 멀티패스 목록에 나타나는지 확인하십시오.
+
[source, shell]
----
multipath -ll
multipath -a /dev/sdX  # replace sdX with the device name
multipath -r
multipath -ll
----
. 볼륨 그룹을 생성합니다.
+
[source, shell]
----
vgcreate <volume group name> /dev/mapper/<device id>
# Where <volume group name> is the desired name for the volume group and <device id> is the multipath device id.
pvs
# Verify the physical volume is part of the volume group.
vgs
# Verify the volume group is created.
----
. 관리 UI를 사용하여 `https:<proxmox node>:8006`데이터센터를 클릭하고 스토리지를 선택한 다음 추가를 클릭하고 LVM을 선택합니다.
+
.예를 보여주세요
[%collapsible]
====
image:proxmox-ontap-fc-003.png["LVM 스토리지 탐색"]

====
. 스토리지 ID 이름을 입력하고, 기존 볼륨 그룹을 선택한 다음, CLI를 사용하여 방금 생성한 볼륨 그룹을 선택하십시오. 공유 옵션을 선택하세요. Proxmox VE 9 이상 버전에서는 다음을 활성화하십시오. `Allow Snapshots as Volume-Chain` 고급 확인란을 활성화하면 표시되는 옵션입니다.
+
.예를 보여주세요
[%collapsible]
====
image:proxmox-ontap-fc-004.png["lvm 스토리지 생성"]

====
. 다음은 FC를 사용하는 LVM용 샘플 스토리지 구성 파일입니다.
+
.예를 보여주세요
[%collapsible]
====
image:proxmox-ontap-fc-005.png["LVM FC 구성"]

====
+
Proxmox VE 9 이상 버전에서는 스토리지 구성 파일에 추가 옵션이 포함되어 있습니다. `snapshot-as-volume-chain 1` 언제 `Allow Snapshots as Volume-Chain` 활성화되어 있습니다.


