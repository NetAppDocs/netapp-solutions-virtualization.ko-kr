---
sidebar: sidebar 
permalink: proxmox/proxmox-wkld-dp-pbs.html 
keywords: netapp, proxmox, proxmox ve, all-flash, nfs, iscsi, nvme, fc, ontap, storage, aff, asa, virtual machines, vm, containers, proxmox backup server 
summary: NetApp ONTAP 스토리지를 사용하는 Proxmox Backup Server로 Proxmox VE 워크로드를 보호하세요. 이 절차에서는 SnapMirror 복제를 사용한 데이터 저장소 구성, 백업 작업, 복원 절차 및 재해 복구 설정을 다룹니다. 
---
= Proxmox Backup Server와 NetApp ONTAP 사용하여 Proxmox VE 워크로드를 보호하세요.
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
NetApp ONTAP 스토리지와 통합된 Proxmox Backup Server(PBS)를 사용하여 Proxmox 가상 환경(VE) 워크로드를 보호하십시오. 이 절차에서는 ONTAP SnapMirror 복제를 사용한 데이터 저장소 구성, 백업 작업, 복원 절차 및 재해 복구 설정을 다룹니다.

Proxmox Backup Server 아키텍처 및 ONTAP 통합에 대한 자세한 내용은 다음을 참조하십시오. link:proxmox-pbs-architecture.html["NetApp ONTAP 사용한 Proxmox 백업 서버 아키텍처에 대해 알아보세요."].



== 시작하기 전에

* 고가용성과 성능을 위해 PBS와 ONTAP 스토리지 간의 이중화된 네트워크 경로를 확보하십시오.
* 대역폭 및 이중화 향상을 위해 링크 집합(LACP)을 고려하십시오.
* 스토리지 트래픽 성능 향상을 위해 모든 네트워크 장치에서 점보 프레임(MTU 9000)을 구성하십시오.
* NFS의 경우, 적절한 권한을 부여하여 PBS 데이터 저장소용 전용 내보내기를 생성하십시오.
* 블록 프로토콜의 경우, 승인된 PBS 호스트로의 접근을 제한하기 위해 적절한 영역 설정 및 LUN 마스킹을 보장해야 합니다.




== 데이터 저장소 구성

NetApp ONTAP 스토리지를 사용하여 Proxmox Backup Server 데이터 저장소를 구성합니다. 여기에는 PBS 호스트에 ONTAP 스토리지를 마운트하고, PBS 웹 인터페이스에 로컬 데이터 저장소를 생성하고, 선택적으로 오프사이트 백업 및 장기 보존을 위해 ONTAP S3 스토리지를 구성하는 작업이 포함됩니다.

ONTAP 스토리지 백엔드를 준비하고 PBS 호스트에 마운트합니다. 준비 단계는 파일 기반(NFS) 프로토콜을 사용하는지 블록 기반(SAN/NVMe-oF) 프로토콜을 사용하는지에 따라 다릅니다.

PBS는 로컬 저장소에 마운트된 모든 폴더를 데이터 저장소로 사용할 수 있습니다. PBS는 카탈로그, 인덱스 및 청크 파일을 데이터 저장소에 저장합니다. 최적의 성능과 확장성을 위해 PBS 데이터 저장소로 NetApp ONTAP SAN(iSCSI/FC/NVMe-oF) 또는 NFS 스토리지(nConnect 또는 세션 트렁킹 및 pNFS 활성화)를 사용하십시오.

.PBS 호스트에 스토리지를 마운트합니다.
. SAN 또는 NVMe-oF 프로토콜의 경우 ONTAP 에 LUN 또는 네임스페이스를 생성하고 이를 PBS 호스트에 연결하십시오.
. LUN 또는 네임스페이스를 적절한 파일 시스템(ext4 또는 xfs)으로 포맷하고 PBS 호스트에 마운트하십시오.
. NFS의 경우 PBS 호스트에 NFS 내보내기를 마운트하십시오.
. fstab 또는 automount를 사용하여 시스템 재부팅 시 데이터 저장소가 자동으로 마운트되도록 하십시오.


.PBS에 데이터 저장소를 생성합니다.
스토리지를 마운트한 후 PBS 웹 인터페이스에서 새 데이터 저장소를 생성하십시오.

. 데이터 저장소 > 데이터 저장소 추가로 이동합니다.
. 이름을 입력하고, 데이터 저장소 유형을 로컬로 선택한 다음, 마운트된 폴더를 백업 경로로 지정하십시오.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-002.png[PBS의 로컬 데이터 저장소 구성]

====


.-> ONTAP S3 스토리지를 사용하여 데이터 저장소를 구성합니다.
S3 스토리지는 일반적으로 오프사이트 백업 및 장기 보존에 사용됩니다. Proxmox Backup Server는 기술 미리보기 기능으로 S3 스토리지를 지원합니다.

. ONTAP S3 서비스가 활성화되어 있고 올바르게 구성되어 있는지 확인하십시오.
. PBS 데이터 저장소용 ONTAP S3 버킷을 생성합니다.
. S3 버킷에 대한 액세스 키와 비밀 키를 얻으세요.
. S3 엔드포인트 URL과 인증서 지문 정보를 수집합니다.
. PBS 웹 인터페이스에서 구성 > S3 엔드포인트로 이동하여 수집한 정보를 사용하여 새 S3 엔드포인트를 추가합니다.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-003.png[PBS의 S3 엔드포인트 구성]

====
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-004.png[PBS의 S3 엔드포인트 구성 파일]

====
. 다음으로, 데이터 저장소 → 데이터 저장소 추가로 이동합니다. 이름을 입력하고, 데이터 저장소 유형을 S3로 선택한 다음, 구성된 S3 엔드포인트를 선택하십시오. 로컬 캐시로 사용할 로컬 데이터 저장소의 폴더 이름을 지정하고 버킷을 선택하십시오. 예시를 보여주세요


[]
====
image::proxmox-wkld-dp-pbs-005.png[PBS에서 S3 데이터스토어 구성]

image::proxmox-wkld-dp-pbs-006.png[PBS의 S3 데이터스토어 구성 파일]

====


== ONTAP S3 스토리지에 로컬 동기화 작업을 생성합니다.

+ PBS에서 로컬 동기화 작업을 생성하여 로컬 PBS 데이터 저장소에서 ONTAP S3 스토리지로 데이터를 마이그레이션합니다. 이 작업은 백업 데이터를 로컬 데이터 저장소에서 S3 데이터 저장소로 복사하여 오프사이트에 저장하고 장기 보존합니다.

. PBS 웹 인터페이스에서 S3 데이터 저장소 > 동기화 작업으로 이동하여 추가를 클릭합니다.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-007.png[PBS에 로컬 동기화 작업 추가하기]

====
. 위치를 로컬로 선택하고, 소스 로컬 데이터 저장소를 선택한 다음, 원하는 네임스페이스와 깊이를 지정합니다. 동기화 작업 일정 및 추가 옵션을 구성합니다.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-008.png[PBS에서 로컬 동기화 작업 구성]

====
. 동기화 작업 구성을 저장합니다. 동기화 작업은 정의된 일정에 따라 실행되며 로컬 PBS 데이터 저장소의 백업 데이터를 ONTAP S3 스토리지로 복사합니다.



NOTE: ONTAP 스토리지를 사용한 오프사이트 저장 및 장기 보존을 위해 Netapp 콘솔을 관리 및 데이터 서비스에 활용할 수 있습니다.



== Proxmox VE 클러스터에 Proxmox 백업 서버 추가

가상 머신 및 컨테이너에 대한 백업 작업을 활성화하려면 Proxmox Backup Server를 스토리지 대상으로 추가하십시오.

. Proxmox VE 웹 인터페이스에서 데이터센터 > 스토리지로 이동한 다음 추가 > Proxmox 백업 서버를 클릭합니다.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-009.png[Proxmox VE에 PBS 저장 기능 추가하기]

====
. 안전한 통신을 위해 PBS 서버 인증서 지문을 제공하십시오. PBS 웹 인터페이스에서 또는 PBS에서 다음 명령어를 실행하여 지문을 얻을 수 있습니다. `proxmox-backup-manager cert info`.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-010.png[Proxmox Backup Server UI에서 PBS 인증서 지문 구성]

====
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-011.png[Proxmox Backup Server CLI에서 PBS 인증서 지문 구성]

====
. 백업 보존 정책 및 암호화와 같은 추가 옵션을 구성하십시오.
. PBS 저장소 구성을 저장하려면 [추가]를 클릭하십시오.


이제 Proxmox VE 클러스터는 가상 머신 및 컨테이너의 백업 및 복원 작업을 위해 PBS 데이터 저장소를 사용할 수 있습니다.



== 백업을 수행하십시오

Proxmox VE 워크로드를 Proxmox 백업 서버에 백업합니다. 여기에는 온디맨드 백업 수행, 예약 백업 작업 구성, 호스트 구성 파일 백업, 사용자 지정 작업을 위한 백업 전후 스크립트 사용 등이 포함됩니다.

.-> 필요에 따라 백업을 수행합니다.
Proxmox Backup Server를 사용하여 VM 또는 컨테이너의 즉시 백업을 생성합니다.

. Proxmox VE 웹 인터페이스에서 VM 또는 컨테이너로 이동합니다.
. 백업 탭을 클릭한 다음 지금 백업을 클릭하세요.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-012.png[Proxmox VE의 온디맨드 백업]

====
. 백업 대상으로 Proxmox Backup Server Storage를 선택하십시오.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-013.png[Proxmox VE에서 PBS 대상 스토리지를 선택하는 온디맨드 백업]

====
. 압축, 알림, 스냅샷 모드와 같은 추가 백업 옵션을 구성하십시오.
. 백업을 클릭하여 백업 프로세스를 시작하세요.


.-> 예약 백업 구성
Proxmox Backup Server를 사용하여 VM 및 컨테이너에 대한 예약 백업을 설정하세요.

. Proxmox VE 웹 인터페이스에서 데이터센터 > 백업으로 이동합니다.
. 새 백업 작업을 생성하려면 [추가]를 클릭하십시오.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-014.png[Proxmox VE에 예약 백업 작업 추가하기]

====
. PBS 저장소를 대상으로 선택하고 백업 일정(예: 매일 또는 매주)을 선택하십시오. 선택 모드를 전체, 포함/제외할 VM/CT 선택 또는 풀 기반으로 설정하십시오.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-015.png[Proxmox VE에서 예약된 백업 작업 구성]

====
. 보존 정책, 압축, 스냅샷 모드와 같은 추가 옵션을 구성하십시오.
. 예약된 백업 작업 구성을 저장하려면 [생성]을 클릭하십시오.
+
.결과
Proxmox VE 클러스터는 Proxmox Backup Server를 스토리지 대상으로 사용하여 정의된 일정에 따라 지정된 VM 및 컨테이너의 백업을 자동으로 수행합니다.

+
예약된 작업 구성은 Proxmox VE 호스트의 /etc/pve/job.cfg 파일에 저장됩니다.

+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-016.png[Proxmox VE의 예약 백업 작업 구성 파일]

====


.-> Proxmox VE 호스트 파일을 PBS에 백업합니다.
Proxmox VE 호스트 구성 파일, 시스템 설정 및 기타 중요 데이터를 Proxmox 백업 서버에 백업합니다.

. Proxmox VE 셸 또는 SSH 세션에서 다음을 사용하십시오. `proxmox-backup-client` 호스트 백업을 생성하는 명령어:
+
[source]
----
proxmox-backup-client backup <backupspec> --repository <pbs-storage>:<datastore> --ns <namespace>
----
+
바꾸다 `<backupspec>` 백업 사양(예: `backupname and backuptype/<directory or files to backup>`), `<pbs-storage>` PBS의 FQDN을 사용하면 `<datastore>` PBS 데이터 저장소 이름과 함께 `<namespace>` 네임스페이스와 함께. 이는 인증 및 지문 환경 변수가 구성되어 있다고 가정합니다.

+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-017.png[Proxmox VE 호스트 백업 명령]

====
. 백업 프로세스는 Proxmox VE 호스트의 백업을 생성하여 지정된 PBS 데이터 저장소에 저장합니다.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-018.png[Proxmox Backup Server UI에서 파일 보기]

====
. Proxmox VE 호스트 파일을 백업에서 복원하려면 다음을 사용하십시오. `proxmox-backup-client restore` 적절한 매개변수를 사용한 명령입니다.


Proxmox VE는 백업 전후에 사용자 지정 작업을 수행할 수 있는 백업 전후 스크립트를 지원합니다. 이러한 스크립트를 사용하여 가상 머신이나 컨테이너를 백업 준비하거나, 추가 작업을 수행하거나, 백업 완료 후 정리 작업을 할 수 있습니다.

. Proxmox VE 호스트에 백업 스크립트를 생성합니다. 스크립트가 실행 가능하고 필요한 권한이 있는지 확인하십시오.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-020.png[백업 스크립트에 대한 스크립트 인자 세부 정보]

====
. 백업 작업이 존재하는지 확인하십시오.
. Proxmox VE 셸 또는 SSH 세션에서 다음을 사용하십시오. `pvesh` 명령 `--script` 실행할 스크립트를 지정하는 옵션입니다.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-019.png[Proxmox VE에서 백업 스크립트 설정하기]

====
. 선택적으로, 백업용 스냅샷을 찍기 전에 워크로드 내부의 파일 시스템을 QEMU 게스트 에이전트를 사용하여 일시 중지할 수 있습니다. QEMU 게스트 에이전트가 설치되어 실행 중인지 확인하십시오. 해당 스크립트를 VM 또는 컨테이너 내부의 /etc/qemu/fsfreeze-hook.d/ 또는 /etc/qemu-ga/fsfreeze-hook.d/ 경로에 배치하십시오.



NOTE: 후크스크립트는 VM 또는 컨테이너 수준에서도 설정할 수 있습니다. `qm set` 또는 `pct set` 명령어를 사용하여 `--hookscript` 옵션. 샘플 후크스크립트는 Proxmox VE 호스트의 /usr/share/pve-docs/examples/guest-example-hookscript.pl을 참조하십시오.



== 가상 머신 및 컨테이너 복원

Proxmox VE 웹 인터페이스 또는 PBS 스토리지에서 VM 및 컨테이너를 직접 복원할 수 있습니다.

. 기존 VM 또는 컨테이너를 복원하려면 Proxmox VE 웹 인터페이스에서 해당 VM 또는 컨테이너로 이동하여 백업 탭을 클릭하고 PBS 스토리지에서 백업을 선택한 다음 복원을 클릭합니다.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-021.png[Proxmox VE에서 PBS를 사용하여 VM 복원하기]

====
+
베어메탈 복구 또는 다른 Proxmox VE 호스트로 복원하려면 다음을 사용하십시오. `proxmox-backup-client` 명령.

. Proxmox VE에서 현재 사용할 수 없는 VM 또는 컨테이너를 복원하려면 PBS 스토리지 백업 섹션으로 이동하여 백업을 선택하고 복원을 클릭하십시오. 복원을 완료하려면 대상 저장소 및 기타 필요한 정보를 제공하십시오.
+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-022.png[Proxmox VE UI에서 PBS 저장소에 저장된 누락된 VM 복원하기]

====




== SnapMirror 사용하여 재해 복구를 구성합니다.

재해 복구를 위해 SnapMirror 사용하여 ONTAP 스토리지의 PBS 데이터 저장소를 다른 ONTAP 시스템으로 복제합니다. 이는 백업 데이터를 보호하고 사이트 장애 발생 후 복원을 가능하게 합니다.

. PBS 데이터스토어 볼륨에 대한 SnapMirror 복제를 구성합니다.
. 재해가 발생할 경우, 복제된 PBS 데이터 저장소를 보조 PBS 인스턴스에 마운트하십시오.
+
PBS에 데이터 저장소를 추가할 때, 데이터 저장소 재초기화를 방지하려면 "기존 데이터 저장소 재사용" 고급 옵션을 활성화하십시오.

+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-023.png[PBS에서 기존 데이터 저장소를 재사용합니다.]

====
+
ONTAP S3 스토리지의 경우, PBS에서 데이터스토어를 추가할 때 "기존 데이터스토어 재사용" 및 "사용 중인 마커 덮어쓰기" 옵션을 모두 활성화하십시오.

+
.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-024.png[PBS에서 기존 S3 데이터 저장소 재사용]

====
+
.결과
데이터 저장소를 추가한 후에는 백업 데이터에 접근하여 복원 작업을 수행할 수 있습니다.





== Proxmox Datacenter Manager를 사용하여 여러 클러스터를 모니터링하세요.

Proxmox Datacenter Manager(PDM)를 사용하여 여러 Proxmox VE 및 Proxmox Backup Server 인스턴스를 모니터링하고 관리합니다. PDM은 여러 Proxmox VE 클러스터 및 PBS 인스턴스의 상태, 성능 및 상태를 모니터링하기 위한 중앙 집중식 관리 인터페이스를 제공합니다.

.예를 보여주세요
[%collapsible]
====
image::proxmox-wkld-dp-pbs-025.png[Proxmox 데이터센터 관리자 개요]

====


== 요약

Proxmox Backup Server는 NetApp ONTAP 스토리지와 통합되어 Proxmox VE 워크로드에 강력하고 효율적인 데이터 보호 기능을 제공합니다. 조직은 ONTAP의 고급 데이터 관리 기능과 PBS의 백업 기능을 활용하여 가상화된 워크로드의 가용성과 무결성을 보장할 수 있습니다.
