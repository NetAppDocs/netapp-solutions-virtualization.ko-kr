---
sidebar: sidebar 
permalink: hyperv/hyperv-deploy-considerations.html 
keywords: hyperv, hyper-v, deploy, netapp, virtualization, consideration 
summary: 이 솔루션은 NetApp 스토리지에 Hyper-V를 배포하는 데 필요한 단계를 제공합니다. 
---
= ONTAP 스토리지 시스템을 사용한 Microsoft Hyper-V 배포 지침
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAP 저장소와 함께 Microsoft Hyper-V를 배포할 때 최적의 성능과 안정성을 보장하려면 워크로드 호환성, 저장소 크기, VM 리소스 할당과 같은 요소를 고려하세요.  호환성 검사에는 Hyper-V 환경 내에서 원활한 작동을 보장하기 위해 OS 버전, 애플리케이션, 데이터베이스 및 기존 사용자 지정이 포함되어야 합니다.



== 저장 공간 적정 크기

워크로드를 배포하거나 기존 하이퍼바이저에서 마이그레이션하기 전에 워크로드 크기가 필요한 성능을 충족하는지 확인하세요.  이는 CPU(사용/프로비저닝), 메모리(사용/프로비저닝), 스토리지(프로비저닝/활용), 네트워크 처리량 및 지연 시간과 함께 읽기/쓰기 IOP, 처리량 및 블록 크기에 대한 통계를 수집하는 각 개별 VM의 성능 데이터를 수집하여 쉽게 수행할 수 있습니다.  이러한 매개변수는 성공적인 배포와 스토리지 어레이 및 워크로드 호스트의 크기를 올바르게 조정하는 데 필수적입니다.

*참고*: Hyper-V 및 관련 워크로드에 대한 저장소 크기를 조정할 때 IOPS와 용량을 계획하세요.

*참고*: I/O 집약도가 높은 VM이나 많은 리소스와 용량이 필요한 VM의 경우 OS 디스크와 데이터 디스크를 분리하세요.  운영 체제와 애플리케이션 바이너리는 자주 변경되지 않으며 볼륨 충돌 일관성이 허용 가능합니다.

*참고*: VHD를 사용하는 것보다 고성능 데이터 디스크의 경우 게스트 연결 스토리지(즉, 게스트 내부 스토리지)를 사용하세요.  이렇게 하면 복제 과정도 더 쉬워집니다.



== 가상 머신 성능 향상

최적의 성능을 위해 적절한 양의 RAM과 vCPU를 선택하고, 단일 가상 SCSI 컨트롤러에 여러 디스크를 연결합니다.  고정 VHDx를 사용하는 것은 배포용 가상 디스크의 기본 선택으로 여전히 권장되며 모든 유형의 VHDX 가상 디스크를 사용하는 데 제한은 없습니다.

*참고*: 활용되지 않을 Windows Server에 불필요한 역할을 설치하지 마세요.

*참고*: SCSI 컨트롤러에서 VM을 로드할 수 있는 가상 머신의 경우 Gen2 세대를 선택하세요. 이 세대는 부팅 수준에서 VMBUS 및 VSP/VSC 아키텍처를 기반으로 하며, 이를 통해 전반적인 VM 성능이 크게 향상됩니다.

*참고*: VM 성능에 부정적인 영향을 미치므로 빈번한 체크포인트 생성은 피하세요.



== SMB3.0 설계 및 고려 사항

SMB 3.0 파일 공유는 Hyper-V의 공유 저장소로 사용할 수 있습니다. ONTAP Hyper-V에서 SMB 공유를 통한 무중단 작업을 지원합니다. Hyper-V는 SMB 파일 공유를 사용하여 구성, 스냅샷, 가상 하드 디스크(VHD) 파일과 같은 가상 머신 파일을 저장할 수 있습니다.  Hyper-V의 SMB3.0 기반 공유에는 전용 ONTAP CIFS SVM을 사용하세요. 가상 머신 파일을 저장하는 데 사용되는 볼륨은 NTFS 보안 방식 볼륨으로 생성해야 합니다.  Hyper-V 호스트와 NetApp 어레이 간의 연결은 사용 가능한 경우 10GB 네트워크에서 수행하는 것이 좋습니다.  1GB 네트워크 연결의 경우 NetApp 여러 개의 1GB 포트로 구성된 인터페이스 그룹을 만드는 것을 권장합니다.  SMB 멀티채널을 제공하는 각 NIC를 전용 IP 서브넷에 연결하여 각 서브넷이 클라이언트와 서버 간에 단일 경로를 제공하도록 합니다.

*핵심 포인트*

* ONTAP SVM에서 SMB 다중 채널 활성화
* ONTAP CIFS SVM은 클러스터의 각 노드에 최소한 하나의 데이터 LIF가 있어야 합니다.
* 사용되는 공유는 지속적으로 사용 가능한 속성 집합으로 구성되어야 합니다.
* ONTAP One은 이제 모든 AFF (A-시리즈 및 C-시리즈), All-SAN Array(ASA), FAS 시스템에 포함됩니다.  따라서 별도의 라이센스가 필요하지 않습니다.
* 공유 VHDx의 경우 게스트 연결 iSCSI LUN을 사용하세요.


*참고*: ODX는 지원되며 여러 프로토콜에서 작동합니다.  파일 공유와 iSCSI 또는 FCP 연결 LUN 간에 데이터를 복사하는 데도 ODX가 활용됩니다.

*참고*: 클러스터 내 노드의 시간 설정은 이에 따라 설정해야 합니다.  NetApp CIFS 서버가 Windows Active Directory(AD) 도메인에 참여해야 하는 경우 NTP(네트워크 시간 프로토콜)를 사용해야 합니다.

*참고*: 큰 MTU 값은 CIFS 서버를 통해 활성화해야 합니다.  패킷 크기가 작으면 성능이 저하될 수 있습니다.



== SMB 볼륨 프로비저닝

. 스토리지 가상 머신(SVM)에서 필수 CIFS 서버 옵션이 활성화되어 있는지 확인하세요.
. 다음 옵션은 true로 설정해야 합니다. smb2-enabled smb3-enabled copy-offload-enabled shadowcopy-enabled is-multichannel-enabled is-large-mtu-enabled
+
image:hyperv-deploy-003.png["SMB 컬럼 설정 이미지"]

. 저장소 가상 머신(SVM)에 NTFS 데이터 볼륨을 만든 다음 Hyper-V와 함께 사용할 수 있도록 지속적으로 사용 가능한 공유를 구성합니다.
+
image:hyperv-deploy-004.png["NTFS 데이터 볼륨 설정 이미지"]

+
*참고*: SMB를 통한 Hyper-V의 비중단 작업은 구성에 사용된 볼륨이 NTFS 보안 스타일 볼륨으로 생성되지 않는 한 제대로 작동하지 않습니다.

. 지속적으로 사용 가능한 기능을 활성화하고 공유에 대한 NTFS 권한을 구성하여 Hyper-V 노드에 대한 전체 제어 권한을 포함합니다.
+
image:hyperv-deploy-005.png["NTFS 권한 설정 이미지"]



자세한 모범 사례 지침은 다음을 참조하세요.link:https://docs.netapp.com/us-en/ontap-apps-dbs/microsoft/win_overview.html["Hyper-V에 대한 배포 지침 및 모범 사례"] .

추가 정보는 다음을 참조하세요.link:https://docs.netapp.com/us-en/ontap/smb-hyper-v-sql/server-volume-requirements-hyper-v-concept.html["SMB를 통한 Hyper-V에 대한 SMB 서버 및 볼륨 요구 사항"] .



== 블록 프로토콜 설계 및 고려 사항

*핵심 포인트*

* 호스트에서 다중 경로(MPIO)를 사용하여 여러 경로를 관리합니다.  데이터 이동성 작업을 용이하게 하거나 추가 I/O 리소스를 활용하기 위해 필요에 따라 더 많은 경로를 만들 수 있지만 호스트 OS가 지원할 수 있는 최대 경로 수를 초과하지 마세요.
* LUN에 액세스하는 호스트에 호스트 유틸리티 키트를 설치합니다.
* 최소 8권을 만드세요.


*참고*: 볼륨당 하나의 LUN을 사용하여 LUN과 CSV 비율이 1:1이 되도록 매핑합니다.

* SVM은 iSCSI 또는 파이버 채널을 사용하여 데이터를 제공할 모든 스토리지 컨트롤러의 이더넷 네트워크 또는 파이버 채널 패브릭당 하나의 LIF를 가져야 합니다.
* FCP 또는 iSCSI를 사용하여 데이터를 제공하는 SVM에는 SVM 관리 인터페이스가 필요합니다.




== ISCSI 볼륨 프로비저닝

iSCSI 볼륨을 프로비저닝하려면 다음 전제 조건이 충족되었는지 확인하세요.

* 스토리지 가상 머신(SVM)에는 iSCSI 프로토콜이 활성화되어 있어야 하며 적절한 논리 인터페이스(LIF)가 생성되어야 합니다.
* 지정된 집계에는 LUN을 포함할 만큼 충분한 여유 공간이 있어야 합니다.


*참고*: 기본적으로 ONTAP SLM(선택적 LUN 맵)을 사용하여 LUN과 해당 고가용성(HA) 파트너를 소유한 노드의 경로를 통해서만 LUN에 액세스할 수 있도록 합니다.

* LUN이 클러스터의 다른 노드로 이동하는 경우 LUN 이동성을 위해 모든 노드에서 모든 iSCSI LIF를 구성합니다.


*단계*

. 시스템 관리자를 사용하여 LUN 창으로 이동합니다(동일한 작업에 ONTAP CLI를 사용할 수 있습니다).
. 만들기를 클릭합니다.
. LUN을 생성할 지정된 SVM을 찾아 선택하면 LUN 생성 마법사가 표시됩니다.
. 일반 속성 페이지에서 Hyper-V 가상 머신의 가상 하드 디스크(VHD)가 포함된 LUN에 대해 Hyper-V를 선택합니다.
+
image:hyperv-deploy-006.png["Hyper-V LUN 생성을 위한 일반 속성 페이지 이미지"]

. <추가 옵션 클릭> LUN 컨테이너 페이지에서 기존 FlexVol volume 선택합니다. 그렇지 않으면 새 볼륨이 생성됩니다.
. <추가 옵션 클릭> 이니시에이터 매핑 페이지에서 이니시에이터 그룹 추가를 클릭하고, 일반 탭에 필요한 정보를 입력한 다음, 이니시에이터 탭에서 호스트의 iSCSI 이니시에이터 노드 이름을 입력합니다.
. 세부 정보를 확인한 후 마침을 클릭하여 마법사를 완료합니다.


LUN이 생성되면 장애 조치(Failover) 클러스터 관리자로 이동합니다.  CSV에 디스크를 추가하려면 디스크를 클러스터의 사용 가능한 저장소 그룹에 추가해야 합니다(아직 추가되지 않은 경우). 그런 다음 디스크를 클러스터의 CSV에 추가해야 합니다.

*참고*: CSV 기능은 장애 조치(Failover) 클러스터링에서 기본적으로 활성화됩니다.

*사용 가능한 저장소에 디스크 추가:*

. 장애 조치(Failover) 클러스터 관리자의 콘솔 트리에서 클러스터 이름을 확장한 다음 저장소를 확장합니다.
. 디스크를 마우스 오른쪽 버튼으로 클릭한 다음 디스크 추가를 선택합니다.  장애 조치(failover) 클러스터에서 사용할 수 있는 디스크를 보여주는 목록이 나타납니다.
. 추가할 디스크를 선택한 다음 확인을 선택합니다.
. 이제 디스크가 사용 가능한 저장소 그룹에 할당되었습니다.
. 완료되면 사용 가능한 저장소에 할당된 디스크를 선택하고 선택 항목을 마우스 오른쪽 버튼으로 클릭한 다음 클러스터 공유 볼륨에 추가를 선택합니다.
+
image:hyperv-deploy-007.png["클러스터 공유 볼륨에 추가 인터페이스 이미지"]

. 이제 디스크가 클러스터의 클러스터 공유 볼륨 그룹에 할당되었습니다.  디스크는 %SystemDrive%ClusterStorage 폴더 아래에 번호가 매겨진 볼륨(마운트 포인트)으로 각 클러스터 노드에 노출됩니다.  볼륨은 CSVFS 파일 시스템에 나타납니다.


추가 정보는 다음을 참조하세요.link:https://learn.microsoft.com/en-us/windows-server/failover-clustering/failover-cluster-csvs#add-a-disk-to-csv-on-a-failover-cluster["장애 조치 클러스터에서 클러스터 공유 볼륨 사용"] .

*고가용성 가상 머신 만들기:*

고가용성 가상 머신을 만들려면 다음 단계를 따르세요.

. 장애 조치(Failover) 클러스터 관리자에서 원하는 클러스터를 선택하거나 지정합니다.  클러스터 아래의 콘솔 트리가 확장되었는지 확인하세요.
. 역할을 클릭합니다.
. 작업 창에서 가상 머신을 클릭한 다음 새 가상 머신을 클릭합니다.  새 가상 머신 마법사가 나타납니다. 다음을 클릭하세요.
. 이름 및 위치 지정 페이지에서 가상 머신의 이름(예: nimdemo)을 지정합니다.  가상 머신을 다른 위치에 저장을 클릭한 다음 전체 경로를 입력하거나 찾아보기를 클릭하여 공유 저장소로 이동합니다.
. 물리적 네트워크 어댑터와 연결된 가상 스위치에 메모리를 할당하고 네트워크 어댑터를 구성합니다.
. 가상 하드 디스크 연결 페이지에서 가상 하드 디스크 만들기를 클릭합니다.
. 설치 옵션 페이지에서 부팅 CD/DVD-ROM에서 운영 체제 설치를 클릭합니다.  미디어에서 미디어 위치를 지정한 다음 마침을 클릭합니다.
. 가상 머신이 생성됩니다.  그러면 장애 조치(Failover) 클러스터 관리자의 고가용성 마법사가 자동으로 가상 머신의 고가용성을 구성합니다.




== ODX 기능을 사용한 가상 디스크의 빠른 프로비저닝

ONTAP 의 ODX 기능을 사용하면 ONTAP 스토리지 시스템에서 호스팅되는 마스터 VHDX 파일을 간단히 복사하여 마스터 VHDX의 복사본을 만들 수 있습니다.  ODX 지원 복사는 네트워크 회선에 데이터를 저장하지 않으므로 복사 프로세스가 NetApp 스토리지 측에서 발생하며 결과적으로 최대 6~8배 더 빨라질 수 있습니다.  빠른 프로비저닝을 위한 일반적인 고려 사항에는 파일 공유에 저장된 마스터 sysprep 이미지와 Hyper-V 호스트 컴퓨터에서 시작하는 정기적인 복사 프로세스가 포함됩니다.

*참고*: ONTAP SMB와 SAN 프로토콜 모두에 대해 ODX를 지원합니다.

*참고*: Hyper-V에서 ODX 복사 오프로드 패스스루 사용 사례를 활용하려면 게스트 운영 체제가 ODX를 지원해야 하며, 게스트 운영 체제의 디스크는 ODX를 지원하는 스토리지(SMB 또는 SAN)로 백업된 SCSI 디스크여야 합니다.  게스트 운영 체제의 IDE 디스크는 ODX 패스스루를 지원하지 않습니다.



== 성능 최적화

CSV당 권장되는 VM 수는 주관적이지만, 각 CSV 또는 SMB 볼륨에 배치할 수 있는 최적의 VM 수는 여러 요소에 따라 결정됩니다.  대부분 관리자는 용량만 고려하지만, VHDx로 전송되는 동시 I/O 양은 전반적인 성능을 결정하는 가장 중요한 요소 중 하나입니다.  성능을 제어하는 가장 쉬운 방법은 각 CSV 또는 공유에 배치되는 가상 머신의 수를 조절하는 것입니다.  동시 가상 머신 I/O 패턴이 CSV 또는 공유에 너무 많은 트래픽을 전송하는 경우 디스크 대기열이 채워지고 지연 시간이 길어집니다.



== SMB 볼륨 및 CSV 크기 조정

병목 현상을 방지하기 위해 솔루션의 크기가 엔드투엔드 전체에 걸쳐 적절한지 확인하고, Hyper-V VM 저장 목적으로 볼륨을 생성할 때는 필요한 것보다 크지 않은 볼륨을 생성하는 것이 가장 좋습니다.  적절한 크기의 볼륨을 사용하면 실수로 CSV에 너무 많은 가상 머신을 배치하는 것을 방지하고 리소스 경합 가능성을 줄일 수 있습니다.  각 클러스터 공유 볼륨(CSV)은 하나 또는 여러 개의 VM을 지원합니다.  CSV에 배치할 VM 수는 작업 부하와 비즈니스 선호도, 스냅샷 및 복제와 같은 ONTAP 스토리지 기능을 사용하는 방법에 따라 결정됩니다.  대부분의 배포 시나리오에서 여러 VM을 CSV에 배치하는 것은 좋은 시작점입니다.  성능 및 데이터 보호 요구 사항을 충족하려면 특정 사용 사례에 맞게 이 접근 방식을 조정하세요.

볼륨과 VHDx 크기는 쉽게 늘릴 수 있으므로 VM에 추가 용량이 필요한 경우 필요한 것보다 더 큰 CSV 크기를 조정할 필요가 없습니다.  Diskpart를 사용하여 CSV 크기를 확장할 수도 있고, 더 쉬운 방법은 새 CSV를 만들고 필요한 VM을 새 CSV로 마이그레이션하는 것입니다.  최적의 성능을 위해서는 임시방편으로 CSV 크기를 늘리는 것보다는 CSV 수를 늘리는 것이 가장 좋습니다.



== 이주

현재 시장 상황에서 가장 흔한 사용 사례 중 하나가 마이그레이션입니다.  고객은 VMM Fabric이나 다른 타사 마이그레이션 도구를 사용하여 VM을 마이그레이션할 수 있습니다.  이러한 도구는 호스트 수준 복사를 사용하여 소스 플랫폼에서 대상 플랫폼으로 데이터를 이동합니다. 이 작업에는 마이그레이션 범위에 있는 가상 머신의 수에 따라 시간이 많이 걸릴 수 있습니다.

이러한 시나리오에서 ONTAP 사용하면 호스트 기반 마이그레이션 프로세스를 사용하는 것보다 더 빠른 마이그레이션이 가능합니다.  ONTAP 사용하면 한 하이퍼바이저에서 다른 하이퍼바이저로(이 경우 ESXi에서 Hyper-V로) VM을 빠르게 마이그레이션할 수도 있습니다.  모든 크기의 VMDK는 NetApp 스토리지에서 몇 초 만에 VHDx로 변환될 수 있습니다.  이것이 바로 PowerShell 방식입니다. NetApp FlexClone 기술을 활용해 VM 하드 디스크를 빠르게 변환합니다.  또한 대상 및 목적지 VM의 생성과 구성을 처리합니다.

이 프로세스는 가동 중지 시간을 최소화하고 비즈니스 생산성을 높이는 데 도움이 됩니다.  또한 라이선스 비용, 종속성, 단일 공급업체에 대한 의무를 줄임으로써 선택권과 유연성을 제공합니다.  이는 VM 라이선스 비용을 최적화하고 IT 예산을 확대하려는 조직에도 유용합니다.

다음 비디오에서는 VMware ESX에서 Hyper-V로 가상 머신을 마이그레이션하는 프로세스를 보여줍니다.

.ESX에서 Hyper-V로의 제로 터치 마이그레이션
video::f4bd0e96-9517-465a-be53-b16d00e305fe[panopto]
Flexclone 및 PowerShell을 사용한 마이그레이션에 대한 추가 정보는 다음을 참조하세요.link:hyperv-deploy-script.html["마이그레이션을 위한 PowerShell 스크립트"] .
