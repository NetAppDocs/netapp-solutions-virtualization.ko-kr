---
sidebar: sidebar 
permalink: hyperv/hyperv-deploy-data-protection.html 
keywords: hyperv, hyper-v, deploy, netapp, virtualization, data, protection 
summary: 이 솔루션은 NetApp 스토리지에 Hyper-V를 배포하는 데 필요한 단계를 제공합니다. 
---
= NetApp 스토리지에 Microsoft Hyper-V 배포
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAP 스토리지 기반 솔루션과 타사 백업 통합을 사용하여 Microsoft Hyper-V 가상 머신을 배포합니다.  이 프로세스에는 ONTAP 스냅샷 복사본과 FlexClone 기술을 사용하여 빠른 백업 및 복원 작업을 수행하고, 엔터프라이즈 백업 관리를 위해 CommVault IntelliSnap을 구성하고, 사이트 간 백업 및 재해 복구를 위해 SnapMirror 복제를 구현하는 작업이 포함됩니다.

클러스터 환경에서 디스크 ID 충돌과 같은 고유한 Hyper-V 백업 고려 사항을 해결하고 독립 실행형 호스트와 Hyper-V 클러스터에 대한 데이터 보호를 최적화하는 방법을 알아보세요.



== NetApp 스토리지 스냅샷을 사용하여 복원

ONTAP 볼륨의 가장 큰 장점 중 하나는 VM을 백업하고 빠르게 복구하거나 복제하는 기능입니다.  스냅샷 복사를 사용하면 성능에 영향을 주지 않고 VM 또는 전체 CSV 볼륨의 빠른 FlexClone 복사를 만들 수 있습니다.  이를 통해 프로덕션 데이터 볼륨을 복제하고 QA, 스테이징 및 개발 환경에 마운트할 때 데이터 손상 위험 없이 프로덕션 데이터로 작업할 수 있습니다.  FlexClone 볼륨은 데이터를 복사하는 데 필요한 공간을 두 배로 늘리지 않고도 운영 데이터의 테스트 사본을 만드는 데 유용합니다.

Hyper-V 노드는 각 디스크에 고유한 ID를 할당하고 해당 파티션(MBR 또는 GPT)이 있는 볼륨의 스냅샷을 찍으면 동일한 고유 식별자가 부여됩니다.  MBR은 디스크 서명을 사용하고 GPT는 GUID(Global Unique Identifiers)를 사용합니다.  독립 실행형 Hyper-V 호스트의 경우 FlexClone 볼륨을 충돌 없이 쉽게 마운트할 수 있습니다.  독립 실행형 Hyper-V 서버는 중복된 디스크 ID를 자동으로 감지하고 사용자 개입 없이 동적으로 변경할 수 있기 때문입니다.  이 접근 방식은 시나리오 요구에 따라 VHD를 복사하여 VM을 복구하는 데 사용할 수 있습니다.

독립 실행형 Hyper-V 호스트에서는 간단하지만 Hyper-V 클러스터에서는 절차가 다릅니다.  복구 프로세스에는 FlexClone 볼륨을 독립 실행형 Hyper-V 호스트에 매핑하거나 diskpart를 사용하여 FlexClone 볼륨을 독립 실행형 Hyper-V 호스트에 매핑하여 서명을 수동으로 변경하는 작업이 포함됩니다(디스크 ID 충돌로 인해 디스크를 온라인 상태로 전환할 수 없게 되므로 중요함). 작업이 완료되면 FlexClone 볼륨을 클러스터에 매핑합니다.



== 타사 솔루션을 사용한 백업 및 복원

*참고*: 이 섹션에서는 Commvault를 사용하지만, 이는 다른 타사 솔루션에도 적용될 수 있습니다.

CommVault IntelliSnap은 ONTAP 스냅샷을 활용하여 Hyper-V의 하드웨어 기반 스냅샷을 생성합니다. Hyper-V 하이퍼바이저 또는 VM 그룹의 구성에 따라 백업을 자동화하거나, VM 그룹 또는 특정 VM에 대해 수동으로 백업할 수 있습니다.  IntelliSnap을 사용하면 Hyper-V 환경을 빠르게 보호할 수 있으며, 프로덕션 가상화 팜의 부하를 최소화할 수 있습니다.  IntelliSnap 기술과 VSA(Virtual Server Agent)의 통합으로 NetApp ONTAP Array는 단 몇 분 만에 많은 수의 가상 머신과 데이터 저장소에 대한 백업을 완료할 수 있습니다.  세분화된 액세스를 통해 전체 게스트 .vhd 파일과 함께 2차 스토리지 계층에서 개별 파일 및 폴더 복구가 제공됩니다.

가상화 환경을 구성하기 전에 어레이와의 스냅샷 통합이 필요한 적절한 에이전트를 배포합니다.  Microsoft Hyper-V 가상화 환경에는 다음 에이전트가 필요합니다.

* 미디어에이전트
* 가상 서버 에이전트(VSA)
* VSS 하드웨어 공급자(Windows Server 2012 및 최신 운영 체제)


*어레이 관리를 사용하여 NetApp 어레이 구성*

다음 단계에서는 ONTAP 어레이와 Hyper-V를 활용하는 환경에서 IntelliSnap 가상 머신 백업을 구성하는 방법을 보여줍니다.

. CommCell Console의 리본에서 스토리지 탭을 클릭한 다음, 어레이 관리를 클릭합니다.
. 배열 관리 대화 상자가 나타납니다.
. 추가를 클릭하세요.
+
배열 속성 대화 상자가 나타납니다.

+
image:hyperv-deploy-009.png["배열 속성 대화 상자 이미지"]

. 일반 탭에서 다음 정보를 지정하세요.
. Snap Vendor 목록에서 NetApp 선택합니다.
. 이름 상자에 기본 파일 서버의 호스트 이름, 정규화된 도메인 이름(FQDN) 또는 TCP/IP 주소를 입력합니다.
. 어레이 액세스 노드 탭에서 사용 가능한 미디어 에이전트를 선택합니다.
. 스냅 구성 탭에서 필요에 따라 스냅샷 구성 속성을 구성합니다.
. OK를 클릭합니다.
. <필수 단계> 완료되면 검색 옵션을 사용하여 NetApp 스토리지 어레이에서 SVM을 구성하여 스토리지 가상 머신(SVM)을 자동으로 검색한 다음 SVM을 선택하고 추가 옵션을 사용하여 CommServe 데이터베이스에 어레이 관리 항목으로 SVM을 추가합니다.
+
image:hyperv-deploy-010.png["SVM을 어레이 관리 항목으로 구성하는 이미지"]

. 고급을 클릭합니다(아래 그래픽 참조). 그리고 "IntelliSnap 사용" 체크박스를 선택합니다.
+
image:hyperv-deploy-011.png["IntelliSnap 활성화 옵션을 표시하는 이미지"]



배열 구성에 대한 자세한 단계는 다음을 참조하세요.link:https://documentation.commvault.com/11.20/configuring_netapp_array_using_array_management.html["NetApp 어레이 구성"] 그리고link:https://documentation.commvault.com/11.20/configure_storage_virtual_machine_on_netapp_storage_array.html["NetApp 어레이에서 스토리지 가상 머신 구성"]

*Hyper-V를 하이퍼바이저로 추가*

다음 단계는 Hyper-V 하이퍼바이저를 추가하고 VM 그룹을 추가하는 것입니다.

*필수 조건*

* 하이퍼바이저는 Hyper-V 클러스터, 클러스터 내의 Hyper-V 서버 또는 독립 실행형 Hyper-V 서버가 될 수 있습니다.
* 사용자는 Hyper-V Server 2012 이상에서 Hyper-V 관리자 그룹에 속해야 합니다.  Hyper-V 클러스터의 경우 사용자 계정에는 전체 클러스터 권한(읽기 및 모든 제어)이 있어야 합니다.
* 백업 및 복원 작업을 위한 액세스 노드(VSA 프록시)를 생성하기 위해 VSA(Virtual Server Agent)를 설치할 하나 이상의 노드를 식별합니다.  Hyper-V 서버를 검색하려면 CommServe 시스템에 VSA가 설치되어 있어야 합니다.
* Hyper-V 2012 R2에 대해 변경된 블록 추적을 사용하려면 Hyper-V 클러스터의 모든 노드를 선택하세요.


다음 단계에서는 Hyper-V를 하이퍼바이저로 추가하는 방법을 보여줍니다.

. 핵심 설정이 완료되면 보호 탭에서 가상화 타일을 클릭합니다.
. 서버 백업 계획 만들기 페이지에서 계획의 이름을 입력한 다음, 저장, 보존 및 백업 일정에 대한 정보를 제공합니다.
. 이제 하이퍼바이저 추가 페이지가 나타납니다. 공급업체 선택: Hyper-V 선택(IP 주소 또는 FQDN 및 사용자 자격 증명 입력)
. Hyper-V 서버의 경우 노드 검색을 클릭합니다.  노드 필드가 채워지면 가상 서버 에이전트를 설치할 하나 이상의 노드를 선택합니다.
+
image:hyperv-deploy-012.png["Hyper-V 노드 검색을 표시하는 이미지"]

. 다음을 클릭하고 저장을 클릭합니다.
+
image:hyperv-deploy-013.png["이전 단계의 결과를 보여주는 이미지"]

. VM 그룹 추가 페이지에서 보호할 가상 머신을 선택합니다(이 경우 Demogrp가 생성된 VM 그룹입니다). 아래에 표시된 대로 IntelliSnap 옵션을 활성화합니다.
+
image:hyperv-deploy-014.png["보호할 VM 선택을 보여주는 이미지"]

+
*참고*: VM 그룹에서 IntelliSnap을 활성화하면 Commvault는 기본(스냅) 사본과 백업 사본에 대한 일정 정책을 자동으로 생성합니다.

. Save를 클릭합니다.


배열 구성에 대한 자세한 단계는 다음을 참조하세요.link:https://documentation.commvault.com/2023e/essential/guided_setup_for_hyper_v.html["하이퍼바이저 추가"] .

*백업 수행:*

. 탐색 창에서 보호 > 가상화로 이동합니다.  가상 머신 페이지가 나타납니다.
. VM 또는 VM 그룹을 백업합니다.  이 데모에서는 VM 그룹이 선택되었습니다.  VM 그룹 행에서 작업 버튼 action_button을 클릭한 다음 백업을 선택합니다.  이 경우, nimplan은 Demogrp 및 Demogrp01과 관련된 계획입니다.
+
image:hyperv-deploy-015.png["백업할 VM을 선택하는 대화 상자를 보여주는 이미지"]

. 백업이 성공적으로 완료되면 화면 캡처에 표시된 대로 복원 지점을 사용할 수 있습니다.  스냅 복사에서 전체 VM 복원, 게스트 파일 및 폴더 복원을 수행할 수 있습니다.
+
image:hyperv-deploy-016.png["백업에 대한 복원 지점을 표시하는 이미지"]

+
*참고*: 중요하고 많이 사용되는 가상 머신의 경우 CSV당 더 적은 수의 가상 머신을 유지하십시오.



*복원 작업 수행:*

복원 지점을 통해 전체 VM, 게스트 파일 및 폴더, 가상 디스크 파일을 복원합니다.

. 탐색 창에서 보호 > 가상화로 이동하면 가상 머신 페이지가 나타납니다.
. VM 그룹 탭을 클릭합니다.
. VM 그룹 페이지가 나타납니다.
. VM 그룹 영역에서 가상 머신이 포함된 VM 그룹에 대해 복원을 클릭합니다.
. 복원 유형 선택 페이지가 나타납니다.
+
image:hyperv-deploy-017.png["백업에 대한 복원 유형을 보여주는 이미지"]

. 선택 사항에 따라 게스트 파일 또는 전체 가상 머신을 선택하고 복원을 시작합니다.
+
image:hyperv-deploy-018.png["복원 옵션을 표시하는 이미지"]



지원되는 모든 복원 옵션에 대한 자세한 단계는 다음을 참조하세요.link:https://documentation.commvault.com/2023e/essential/restores_for_hyper_v.html["Hyper-V 복원"] .



== 고급 NetApp ONTAP 옵션

NetApp SnapMirror 효율적인 사이트 간 스토리지 복제를 지원하여 오늘날의 글로벌 기업에 맞게 재해 복구를 빠르고 안정적이며 관리하기 쉽게 만들어줍니다.  LAN 및 WAN을 통해 고속으로 데이터를 복제하는 SnapMirror 미션 크리티컬 애플리케이션에 높은 데이터 가용성과 빠른 복구 기능을 제공하는 동시에 뛰어난 스토리지 중복 제거 및 네트워크 압축 기능도 제공합니다.  NetApp SnapMirror 기술을 사용하면 재해 복구를 통해 전체 데이터 센터를 보호할 수 있습니다.  볼륨은 점진적으로 오프사이트 위치로 백업될 수 있습니다.  SnapMirror 필요한 RPO만큼 자주 증분형 블록 기반 복제를 수행합니다.  블록 수준 업데이트를 통해 대역폭과 시간 요구 사항이 줄어들고, DR 사이트에서 데이터 일관성이 유지됩니다.

중요한 단계는 전체 데이터 세트에 대한 일회성 기준 전송을 만드는 것입니다.  증분 업데이트를 수행하려면 이 작업이 필요합니다.  이 작업에는 소스에서 스냅샷 복사본을 생성하고 해당 복사본에서 참조하는 모든 데이터 블록을 대상 파일 시스템으로 전송하는 작업이 포함됩니다.  초기화가 완료되면 예약된 업데이트나 수동으로 업데이트가 실행될 수 있습니다.  각 업데이트는 소스에서 대상 파일 시스템으로 새롭고 변경된 블록만 전송합니다.  이 작업에는 소스 볼륨에서 스냅샷 복사본을 만들고, 이를 기준 복사본과 비교하고, 변경된 블록만 대상 볼륨으로 전송하는 작업이 포함됩니다.  새로운 사본은 다음 업데이트를 위한 기준 사본이 됩니다.  복제가 주기적으로 이루어지므로 SnapMirror 변경된 블록을 통합하고 네트워크 대역폭을 절약할 수 있습니다.  쓰기 처리량과 쓰기 대기 시간에 미치는 영향은 최소화됩니다.

다음 단계를 완료하면 복구가 수행됩니다.

. 보조 사이트의 스토리지 시스템에 연결합니다.
. SnapMirror 관계를 끊습니다.
. 보조 사이트의 Hyper-V 서버에 대한 이니시에이터 그룹(igroup)에 SnapMirror 볼륨의 LUN을 매핑합니다.
. LUN이 Hyper-V 클러스터에 매핑되면 이러한 디스크를 온라인 상태로 만듭니다.
. 장애 조치(failover) 클러스터 PowerShell cmdlet을 사용하여 디스크를 사용 가능한 저장소에 추가하고 이를 CSV로 변환합니다.
. CSV 형식의 가상 머신을 Hyper-V 관리자로 가져와서 고가용성으로 만든 다음 클러스터에 추가합니다.
. VM을 켭니다.

