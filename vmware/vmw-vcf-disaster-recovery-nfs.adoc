---
sidebar: sidebar 
permalink: vmware/vmw-vcf-disaster-recovery-nfs.html 
keywords: netapp, vmware, cloud, foundation, vcf, nfs 
summary: NetApp Disaster Recovery 기능을 활용한 VCF용 재해 복구 솔루션. 
---
= NetApp Disaster Recovery
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
NetApp SnapMirror 및 NetApp Disaster Recovery 를 활용한 NFS 데이터스토어용 VCF 재해 복구 솔루션

운영 사이트에서 재해 복구(DR) 사이트로 블록 수준 복제를 수행하면 랜섬웨어 공격을 포함한 사이트 중단 및 데이터 손상 사건으로부터 워크로드를 보호하는 탄력적이고 비용 효율적인 전략을 제공합니다.  NetApp SnapMirror 복제를 사용하면 NFS 또는 VMFS 데이터 저장소를 사용하여 온프레미스 ONTAP 시스템에서 실행되는 VMware VCF 9 워크로드 도메인을 VMware가 배포된 지정된 복구 데이터 센터에 있는 보조 ONTAP 시스템으로 복제할 수 있습니다.

자세한 내용은 다음을 참조하십시오.link:https://docs.netapp.com/us-en/data-services-disaster-recovery/["NetApp Disaster Recovery 설명서"] .

이 섹션에서는 온프레미스 VMware 가상 머신에 대한 재해 복구(DR)를 구축하기 위한 NetApp Disaster Recovery 구성에 대해 설명합니다.

설정에는 다음이 포함됩니다.

* NetApp Console 계정 생성 및 에이전트 배포.
* NetApp Console 에 ONTAP 어레이를 추가하여 관리 대상 시스템을 관리함으로써 VMware vCenter와 ONTAP 스토리지 간의 통신을 용이하게 할 수 있습니다.
* SnapMirror 사용하여 사이트 간 복제를 구성합니다.
* 장애 조치 준비 상태를 검증하기 위한 복구 계획을 설정하고 테스트합니다.


NetApp Console 에 통합된 NetApp Disaster Recovery 통해 조직은 온프레미스 VMware vCenter 및 ONTAP 스토리지 시스템을 원활하게 검색할 수 있습니다. 문제가 발견되면 관리자는 리소스 그룹을 정의하고, 재해 복구 계획을 만들고, 이를 적절한 리소스와 연결하고, 장애 조치 및 장애 복구 작업을 시작하거나 테스트할 수 있습니다. NetApp SnapMirror 효율적인 블록 수준 복제를 제공하여 DR 사이트가 증분 업데이트를 통해 프로덕션 환경과 동기화 상태를 유지하도록 보장합니다. 이를 통해 복구 지점 목표(RPO)를 최소 5분으로 단축할 수 있습니다.

NetApp Disaster Recovery 중단 없는 재해 복구 테스트도 지원합니다. ONTAP의 FlexClone 기술을 활용하여 프로덕션 작업 부하에 영향을 주거나 추가 스토리지 비용을 발생시키지 않고 가장 최근에 복제된 스냅샷에서 NFS 데이터 저장소의 공간 효율적인 임시 복사본을 생성합니다. 테스트 후에는 환경을 쉽게 해체하여 복제된 데이터의 무결성을 보존할 수 있습니다.

실제 장애 조치가 발생할 경우, NetApp Console 복구 프로세스를 오케스트레이션하여 사용자의 개입을 최소화하면서 지정된 재해 복구 사이트에서 보호된 가상 머신을 자동으로 시작합니다. 기본 사이트가 복구되면 서비스는 SnapMirror 관계를 역전시키고 모든 변경 사항을 원래 사이트로 복제하여 원활하고 제어된 장애 복구를 가능하게 합니다.

이러한 모든 기능은 기존 재해 복구 솔루션에 비해 상당히 낮은 비용으로 제공됩니다.

image::vmw-vcf-dr-nfs-001.png[NetApp Disaster Recovery 아키텍처 다이어그램]



== 시작하기

NetApp Disaster Recovery 시작하려면 NetApp Console 사용한 다음 서비스에 액세스하십시오.

. NetApp Console 에 로그인하세요.
. NetApp Console 왼쪽 탐색 메뉴에서 보호 > 재해 복구를 선택합니다.
. NetApp Disaster Recovery 보드가 ​​나타납니다.
+
image::vmw-vcf-dr-nfs-002.png[NetApp Disaster Recovery 보드]



재해 복구 계획을 구성하기 전에 다음 사항을 확인하십시오.link:https://docs.netapp.com/us-en/data-services-disaster-recovery/get-started/dr-prerequisites.html["필수 조건"] 다음 조건이 충족됩니다:

* 콘솔 에이전트는 NetApp Console 에 설정됩니다.
* 에이전트 인스턴스는 소스 및 대상 워크로드 도메인 vCenter 및 스토리지 시스템에 연결됩니다.
* NetApp Data ONTAP 클러스터는 NFS 또는 VMFS 데이터 저장소를 제공합니다.
* VMware용 NFS 또는 VMFS 데이터스토어를 호스팅하는 온프레미스 NetApp 스토리지 시스템은 NetApp Console 에 추가됩니다.
* DNS 이름을 사용하는 경우 DNS 확인이 이루어져야 합니다. 그렇지 않은 경우 vCenter에 IP 주소를 사용하세요.
* SnapMirror 복제는 지정된 NFS 또는 VMFS 기반 데이터 저장소 볼륨에 대해 구성됩니다.
* 해당 환경에 지원되는 vCenter Server 및 ESXi 서버 버전이 있는지 확인하세요.


소스 사이트와 대상 사이트 간의 연결이 설정되면 구성 단계를 진행하세요. 이 작업은 몇 번의 클릭과 약 3~5분 정도 소요됩니다.

참고: NetApp 콘솔 에이전트가 네트워크를 통해 소스 및 대상 리소스와 통신할 수 있도록 대상 사이트 또는 제3의 사이트에 콘솔 에이전트를 배포하는 것을 권장합니다.

이 데모에서는 워크로드 도메인이 ONTAP NFS 스토리지로 구성됩니다.  VMFS 기반 데이터 저장소의 워크플로 단계는 동일하게 유지됩니다.

image::vmw-vcf-dr-nfs-003.png[NetApp Disaster Recovery 상세 대시보드]



== NetApp Disaster Recovery 구성

재해 복구를 준비하는 첫 번째 단계는 소스 vCenter 및 스토리지 리소스를 검색하고 NetApp Disaster Recovery 에 추가하는 것입니다.

NetApp Console 열고 왼쪽 탐색 메뉴에서 보호 > 재해 복구를 선택합니다. 사이트를 선택한 다음 추가를 선택하세요. 새 소스 사이트의 이름과 해당 위치를 입력하십시오. 목적지 사이트와 위치를 추가하려면 이 단계를 반복하십시오.

image::vmw-vcf-dr-nfs-004.png[NetApp Disaster Recovery 상세 대시보드]

다음 플랫폼을 추가하세요:

* 소스 워크로드 도메인 vCenter
* 대상 워크로드 도메인 vCenter.


vCenter가 추가되면 자동 검색이 실행됩니다.



== 소스 사이트 어레이와 대상 사이트 어레이 간의 스토리지 복제 구성

SnapMirror NetApp 환경에서 데이터 복제를 제공합니다. NetApp Snapshot® 기술을 기반으로 구축된 SnapMirror 복제는 이전 업데이트 이후 변경되거나 추가된 블록만 복제하므로 매우 효율적입니다. SnapMirror NetApp OnCommand® System Manager나 ONTAP CLI를 사용하여 쉽게 구성할 수 있습니다. NetApp Disaster Recovery 클러스터와 SVM 피어링이 사전에 구성된 경우 SnapMirror 관계도 생성합니다.

기본 스토리지가 완전히 손실되지 않은 경우 SnapMirror 기본 사이트와 재해 복구 사이트를 효율적으로 재동기화하는 방법을 제공합니다. SnapMirror SnapMirror 관계를 반전시키는 것만으로 두 사이트를 다시 동기화하여 변경되었거나 새로 추가된 데이터만 재해 복구 사이트에서 기본 사이트로 전송할 수 있습니다. 즉, NetApp Disaster Recovery 의 복제 계획은 장애 조치 후 전체 볼륨을 다시 복사하지 않고도 양방향으로 재동기화할 수 있습니다. 관계를 역방향으로 다시 동기화하는 경우, 스냅샷 복사본의 마지막 성공적인 동기화 이후에 기록된 새로운 데이터만 대상으로 다시 전송됩니다.


NOTE: 볼륨에 대해 CLI 또는 시스템 관리자를 통해 SnapMirror 관계가 이미 구성된 경우 NetApp Disaster Recovery 해당 관계를 가져와 나머지 워크플로 작업을 계속 진행합니다.



== NetApp Disaster Recovery 위한 복제 관계 설정 방법

SnapMirror 복제를 생성하는 기본 프로세스는 모든 애플리케이션에 대해 동일합니다.  가장 쉬운 방법은 NetApp Disaster Recovery 기능을 활용하는 것입니다. 다음 두 가지 조건을 충족하면 NetApp 재해 복구 기능이 복제 워크플로를 자동화해 줍니다. 해당 프로세스는 수동 또는 자동일 수 있습니다. 가장 쉬운 방법은 다음 두 가지 기준이 충족되는 경우 복제 워크플로를 자동화하는 NetApp Disaster Recovery를 활용하는 것입니다.

* 소스 클러스터와 대상 클러스터는 피어 관계를 갖습니다.
* 소스 SVM과 대상 SVM은 피어 관계를 갖습니다.


NetApp Console 소스 ONTAP 시스템을 환경 내 대상 시스템으로 간단히 드래그 앤 드롭하여 마법사를 실행하고 나머지 프로세스를 안내하는 방식으로 SnapMirror 복제를 구성하는 또 다른 옵션을 제공합니다.



== NetApp Disaster Recovery 어떤 도움을 줄 수 있을까요?

소스 및 대상 사이트를 추가하면 NetApp Disaster Recovery 자동 심층 검색을 수행하여 VM과 관련 메타데이터를 표시합니다. NetApp Disaster Recovery VM에서 사용하는 네트워크 및 포트 그룹을 자동으로 감지하고 해당 정보를 입력합니다.

image::vmw-vcf-dr-nfs-005.png[NetApp Console 사이트]

사이트를 추가한 후에는 소스 및 대상 vCenter 플랫폼을 선택하고 복제 계획에 포함할 리소스 그룹을 선택하는 한편, 애플리케이션 복원 및 전원 켜기 방법, 클러스터 및 네트워크 매핑을 지정하여 복제 계획을 구성합니다. 복구 계획을 정의하려면 *복제 계획* 탭으로 이동하여 *추가*를 클릭합니다.

이 단계에서는 VM을 리소스 그룹으로 그룹화할 수 있습니다. NetApp Disaster Recovery 리소스 그룹을 사용하면 종속적인 VM 세트를 논리적 그룹으로 묶을 수 있으며, 이러한 그룹에는 복구 시 실행될 부팅 순서와 부팅 지연 시간이 포함됩니다. 리소스 그룹은 복제 계획을 생성하는 동안 또는 왼쪽 탐색 메뉴의 리소스 그룹 탭을 사용하여 생성할 수 있습니다.

먼저 복제 계획의 이름을 지정하고 소스 vCenter와 대상 vCenter를 선택합니다.

image::vmw-vcf-dr-nfs-006.png[NetApp Disaster Recovery 대상 vCenter]

다음 단계는 리소스 그룹, 가상 머신 또는 데이터 저장소 중 어떤 것을 사용하여 복제 계획을 생성할지 선택하는 것입니다. 기존 리소스 그룹을 선택하고, 리소스 그룹이 생성되어 있지 않은 경우 마법사가 복구 목표에 따라 필요한 가상 머신을 그룹화(기본적으로 기능적 리소스 그룹 생성)하는 데 도움을 줍니다. 이는 애플리케이션 가상 머신을 복원하는 작업 순서를 정의하는 데에도 도움이 됩니다.

image::vmw-vcf-dr-nfs-007.png[NetApp Disaster Recovery 보호할 VM을 선택합니다.]


NOTE: 리소스 그룹을 사용하면 드래그 앤 드롭 기능을 사용하여 부팅 순서를 설정할 수 있습니다. 이를 사용하면 복구 프로세스 중에 VM의 전원이 켜지는 순서를 쉽게 수정할 수 있습니다.

복제 계획을 통해 리소스 그룹이 생성되면 다음 단계는 재해 발생 시 가상 머신과 애플리케이션을 복구하기 위한 매핑을 생성하는 것입니다. 이 단계에서는 소스 환경의 리소스가 대상 환경에 어떻게 매핑되는지 지정합니다. 여기에는 컴퓨팅 리소스, 가상 네트워크, IP 사용자 정의, 사전 및 사후 스크립트, 부팅 지연, 애플리케이션 일관성 등이 포함됩니다. 자세한 내용은 다음을 참조하십시오.link:https://docs.netapp.com/us-en/data-services-disaster-recovery/use/drplan-create.html#map-source-resources-to-the-target["복제 계획 만들기"] . 필수 조건에 언급된 것처럼 SnapMirror 복제는 사전에 구성하거나 DRaaS에서 복제 계획 생성 시 지정한 RPO 및 보존 기간을 사용하여 구성할 수 있습니다.

참고: 기본적으로 테스트 및 장애 조치 작업 모두에 동일한 매핑 매개변수가 사용됩니다. 테스트 환경에 대해 다른 매핑을 설정하려면 "장애 조치 및 테스트 매핑에 동일한 매핑 사용" 체크 상자의 선택을 취소한 후 테스트 매핑 옵션을 선택합니다. 리소스 매핑이 완료되면 다음을 클릭하세요.

image::vmw-vcf-dr-nfs-008.png[NetApp 재해 복구 리소스 매핑]

완료되면 생성된 매핑을 검토한 후 계획 추가를 클릭합니다.

image::vmw-vcf-dr-nfs-009.png[NetApp Disaster Recovery 리소스 매핑 검토]


NOTE: 서로 다른 볼륨 및 SVM의 VM을 복제 계획에 포함할 수 있습니다. VM 배치 위치(동일한 SVM 내의 동일 볼륨 또는 별도 볼륨, 또는 서로 다른 SVM 내의 별도 볼륨)에 따라 NetApp Disaster Recovery 일관성 그룹 스냅샷을 생성합니다.

image::vmw-vcf-dr-nfs-010.png[NetApp Disaster Recovery 복제 계획]

계획이 생성되자마자 일련의 검증이 실행되고 SnapMirror 복제 및 일정이 선택 사항에 따라 구성됩니다.

image::vmw-vcf-dr-nfs-011.png[NetApp Disaster Recovery 작업 모니터링]

NetApp Disaster Recovery 다음과 같은 워크플로로 구성됩니다.

* 테스트 장애 조치(주기적 자동 시뮬레이션 포함)
* 클린업 페일오버 테스트
* 장애 조치:
+
** 계획된 마이그레이션(일회성 장애 조치를 위한 사용 사례 확장)
** 재해 복구


* 장애 복구


image::vmw-vcf-dr-nfs-012.png[NetApp Disaster Recovery 복제 계획 조치]



== 테스트 장애 조치

NetApp Disaster Recovery 의 테스트 페일오버는 VMware 관리자가 프로덕션 환경을 중단하지 않고 복구 계획을 완벽하게 검증할 수 있도록 하는 운영 절차입니다.

image::vmw-vcf-dr-nfs-013.png[NetApp Disaster Recovery 복제 계획 테스트 장애 조치]

NetApp Disaster Recovery 테스트 페일오버 작업에서 스냅샷을 선택적 기능으로 선택할 수 있도록 지원합니다. 이 기능을 통해 VMware 관리자는 환경에서 최근에 이루어진 변경 사항이 대상 사이트에 복제되어 테스트 중에 반영되는지 확인할 수 있습니다. 이러한 변경 사항에는 VM 게스트 운영 체제에 대한 패치가 포함됩니다.

image::vmw-vcf-dr-nfs-014.png[NetApp Disaster Recovery 복제 계획 테스트 장애 조치 확인]

VMware 관리자가 테스트 페일오버 작업을 실행하면 NetApp Disaster Recovery 다음 작업을 자동화합니다.

* 최근 프로덕션 사이트에서 변경된 내용을 대상 사이트의 스토리지에 업데이트하기 위해 SnapMirror 관계를 트리거합니다.
* DR 스토리지 어레이에서 FlexVol 볼륨의 NetApp FlexClone 볼륨을 생성합니다.
* FlexClone 볼륨의 데이터스토어를 DR 사이트의 ESXi 호스트에 연결합니다.
* 매핑 중에 지정된 테스트 네트워크에 VM 네트워크 어댑터를 연결합니다.
* DR 사이트의 네트워크에 대해 정의된 대로 VM 게스트 운영 체제 네트워크 설정을 재구성합니다.
* 복제 계획에 저장된 사용자 정의 명령을 실행합니다.
* 복제 계획에 정의된 순서대로 VM의 전원을 켭니다.


image::vmw-vcf-dr-nfs-015.png[NetApp Disaster Recovery 복제 계획 테스트 장애 조치 결과]



== 클린업 페일오버 테스트 작업

정리 장애 조치 테스트 작업은 복제 계획 테스트가 완료되고 VMware 관리자가 정리 프롬프트에 응답한 후에 발생합니다.

image::vmw-vcf-dr-nfs-016.png[NetApp Disaster Recovery 복제 계획 테스트 장애 조치 정리]

이 작업을 수행하면 가상 머신(VM)과 복제 계획의 상태가 준비 상태로 재설정됩니다. VMware 관리자가 복구 작업을 수행하면 NetApp Disaster Recovery 다음 프로세스를 완료합니다.

. 테스트에 사용된 FlexClone 복사본에서 복구된 각 VM의 전원을 끕니다.
. 테스트 중 복구된 VM을 표시하는 데 사용된 FlexClone 볼륨을 삭제합니다.




== 계획된 마이그레이션 및 장애 조치

NetApp Disaster Recovery 실제 장애 조치를 수행하는 두 가지 방법, 즉 계획된 마이그레이션과 장애 조치(fail over)를 제공합니다. 첫 번째 방법인 계획된 마이그레이션은 VM 종료 및 스토리지 복제 동기화를 프로세스에 통합하여 VM을 복구하거나 대상 사이트로 효과적으로 이동합니다. 계획된 마이그레이션을 위해서는 원본 사이트에 대한 접근 권한이 필요합니다. 두 번째 방법인 장애 조치(failover)는 계획된/계획되지 않은 장애 조치로, VM이 마지막 저장소 복제 간격에서 완료될 수 있었던 대상 사이트에서 복구됩니다. 솔루션에 설계된 RPO(복구 목표 시점)에 따라 재해 복구 시나리오에서 일정량의 데이터 손실이 발생할 수 있습니다.

image::vmw-vcf-dr-nfs-017.png[NetApp Disaster Recovery 복제 계획 장애 조치]

image::vmw-vcf-dr-nfs-018.png[NetApp Disaster Recovery 복제 계획 페일오버 작업 확인]

VMware 관리자가 장애 조치 작업을 수행하면 NetApp Disaster Recovery 다음 작업을 자동화합니다.

* NetApp SnapMirror 관계를 끊고 장애 조치합니다.
* 복제된 데이터 저장소를 DR 사이트의 ESXi 호스트에 연결합니다.
* VM 네트워크 어댑터를 적절한 대상 사이트 네트워크에 연결합니다.
* 대상 사이트의 네트워크에 대해 정의된 대로 VM 게스트 운영 체제 네트워크 설정을 재구성합니다.
* 복제 계획에 저장된 사용자 정의 명령(있는 경우)을 실행합니다.
* 복제 계획에 정의된 순서대로 VM의 전원을 켭니다.


image::vmw-vcf-dr-nfs-019.png[vSphere Client - 전원이 켜진 VM]



== 장애 복구

장애 복구는 복구 후 소스 및 대상 사이트의 원래 구성을 복원하는 선택적 절차입니다.

image::vmw-vcf-dr-nfs-020.png[NetApp Disaster Recovery 복제 계획 페일백 작업]

VMware 관리자는 서비스를 원래 소스 사이트로 복원할 준비가 되면 장애 복구 절차를 구성하고 실행할 수 있습니다.


NOTE: NetApp Disaster Recovery 복제 방향을 바꾸기 전에 모든 변경 사항을 원래 소스 가상 머신으로 복제(재동기화)합니다.

이 프로세스는 대상으로의 장애 조치를 완료한 관계에서 시작되며 다음 단계를 포함합니다.

* 대상 사이트의 가상 머신과 볼륨의 전원을 끄고 등록을 취소합니다.
+
image::vmw-vcf-dr-nfs-021.png[vSphere Client - 최근 작업]

* 원본 소스의 SnapMirror 관계를 끊어서 읽기/쓰기가 가능하도록 합니다.
* 복제를 되돌리려면 SnapMirror 관계를 다시 동기화합니다.
* 소스에 볼륨을 마운트하고, 소스 가상 머신의 전원을 켜서 등록합니다.
+
image::vmw-vcf-dr-nfs-022.png[vSphere Client - 전원이 켜진 VM]



NetApp Disaster Recovery 액세스하고 구성하는 방법에 대한 자세한 내용은 다음을 참조하십시오.link:https://docs.netapp.com/us-en/data-services-disaster-recovery/get-started/dr-intro.html["VMware용 NetApp Disaster Recovery 에 대해 알아보세요"] .



== 모니터링 및 대시보드

NetApp Disaster Recovery 또는 ONTAP CLI에서 해당 데이터스토어 볼륨의 복제 상태를 모니터링할 수 있으며, 작업 모니터링을 통해 장애 조치 또는 테스트 장애 조치의 상태를 추적할 수 있습니다.

image::vmw-vcf-dr-nfs-023.png[NetApp Disaster Recovery 작업 모니터링]


NOTE: 작업이 현재 진행 중이거나 대기 중이고 이를 중지하고 싶은 경우, 취소 옵션이 있습니다.

NetApp Disaster Recovery 대시보드를 사용하면 재해 복구 사이트 및 복제 계획의 상태를 자신 있게 평가할 수 있습니다. 이를 통해 관리자는 정상적인 사이트와 계획, 연결이 끊긴 사이트와 계획, 또는 성능이 저하된 사이트와 계획을 신속하게 식별할 수 있습니다.

image::vmw-vcf-dr-nfs-024.png[NetApp Disaster Recovery 업데이트된 대시보드]

이는 맞춤형 재해 복구 계획을 처리하는 강력한 솔루션을 제공합니다. 장애 조치는 계획된 장애 조치로 수행할 수도 있고, 재해가 발생하고 DR 사이트를 활성화하기로 결정한 경우 버튼을 클릭하여 장애 조치를 수행할 수도 있습니다.
