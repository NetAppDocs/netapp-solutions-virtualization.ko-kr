---
sidebar: sidebar 
permalink: vmware/vmw-vcf-vmsc-viwld-mcc.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, array, ontap tools, otv, sddc, sddc manager, ontap tools, metrocluster 
summary:  
---
= MetroCluster 사용하여 VI 워크로드 도메인에 대한 스트레치 클러스터 구성
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
이 사용 사례에서는 ONTAP MetroCluster 사용하여 NFS를 주 데이터 저장소로 하는 확장된 VCF VI 워크로드 도메인을 구성하는 절차를 설명합니다.  이 절차에는 vSphere 호스트와 vCenter Server 배포, NFS 데이터 저장소 프로비저닝, vSphere 클러스터 검증, VCF 변환 중 NSX 구성, vSphere 환경을 기존 VCF 관리 도메인으로 가져오는 작업이 포함됩니다.

VCF의 작업 부하는 vSphere Metro Storage Cluster(vMSC)로 보호됩니다.  FC 또는 IP 배포가 가능한 ONTAP MetroCluster 일반적으로 VMFS 및 NFS 데이터 저장소의 내결함성을 제공하는 데 활용됩니다.

image:vmw-vcf-vmsc-viwld-mcc-001.png["vMSC가 포함된 VCF VI 워크로드 도메인, 너비=500"]



== 소개

이 솔루션에서는 ONTAP MetroCluster 사용하여 NFS를 주 데이터 저장소로 사용하여 Stetched VCF VI 워크로드 도메인을 구현하는 방법을 보여드리겠습니다.  VI 워크로드 도메인은 SDDC Manager를 사용하여 배포하거나 기존 vSphere 환경을 VI 워크로드 도메인으로 가져올 수 있습니다.



== 시나리오 개요

이 시나리오에서는 다음과 같은 상위 수준 단계를 다룹니다.

* vSphere 호스트와 vCenter 서버를 배포합니다.
* vSphere 호스트에 NFS 데이터 저장소를 프로비저닝합니다.
* VCF 가져오기 도구를 사용하여 vSphere 클러스터를 검증합니다.
* VCF 변환 중에 NSX를 생성하기 위해 JSON 파일을 구성합니다.
* VCF 가져오기 도구를 사용하여 vSphere 8 환경을 VCF VI 워크로드 도메인으로 기존 VCF 관리 도메인으로 가져옵니다.




== 필수 조건

이 시나리오에는 다음과 같은 구성 요소와 구성이 필요합니다.

* 지원되는 ONTAP MetroCluster 구성
* NFS 트래픽을 허용하도록 구성된 스토리지 가상 머신(SVM)입니다.
* NFS 트래픽을 전달하고 SVM과 연관되는 논리적 인터페이스(LIF)가 IP 네트워크에 생성되었습니다.
* 네트워크 스위치에 연결된 4개의 ESXi 호스트가 있는 vSphere 8 클러스터.
* VCF 변환에 필요한 소프트웨어를 다운로드하세요.


다음은 MetroCluster 구성을 보여주는 시스템 관리자의 샘플 스크린샷입니다.image:vmw-vcf-vmsc-mgmt-mcc-015.png["4노드 MetroCluster IP"]

그리고 여기에 두 단층 도메인의 SVM 네트워크 인터페이스가 있습니다.image:vmw-vcf-vmsc-mgmt-mcc-013.png["SVM 네트워크는 Fault Domain 1에서 상호 작용합니다."]

image:vmw-vcf-vmsc-mgmt-mcc-014.png["Fault Domain 2의 SVM 네트워크 인터페이스"]

[참고] SVM은 MetroCluster 의 오류 도메인 중 하나에서 활성화됩니다.

image:vmw-vcf-vmsc-mgmt-mcc-016.png["오류 도메인 1의 SVM"]

image:vmw-vcf-vmsc-mgmt-mcc-017.png["Fault Domain 2의 SVM"]

나타내다 https://knowledge.broadcom.com/external/article/312183/vmware-vsphere-support-with-netapp-metro.html["MetroCluster 를 갖춘 vMSC"] .

vSphere를 VCF 5.2로 변환하거나 가져오기 위해 지원되는 저장소 및 기타 고려 사항은 다음을 참조하세요. https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf-admin.html["기존 vSphere 환경을 VMware Cloud Foundation으로 변환하거나 가져오기 전 고려 사항"] .

VCF 관리 도메인으로 변환될 vSphere 클러스터를 생성하기 전에 다음을 참조하세요. https://knowledge.broadcom.com/external/article/373968/vlcm-config-manager-is-enabled-on-this-c.html["vSphere 클러스터에 대한 NSX 고려 사항"]

필수 소프트웨어는 다음을 참조하세요. https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/download-software-for-converting-or-importing-existing-vsphere-environments-admin.html["기존 vSphere 환경을 변환하거나 가져오기 위한 소프트웨어 다운로드"] .

ONTAP 스토리지 시스템 구성에 대한 정보는 다음을 참조하세요.link:https://docs.netapp.com/us-en/ontap["ONTAP 9 문서"] 센터.

VCF 구성에 대한 정보는 다음을 참조하세요.link:https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2.html["VMware Cloud Foundation 문서"] .



== 배포 단계

NFS를 주 데이터 저장소로 사용하여 VCF Stretched Management Domain을 배포하려면

다음 단계를 완료하세요.

* vSphere 호스트와 vCenter를 배포합니다.
* vSphere 클러스터를 생성합니다.
* NFS 데이터 저장소를 제공합니다.
* VCF 가져오기 도구를 vCenter 어플라이언스에 복사합니다.
* VCF 가져오기 도구를 사용하여 vCenter 어플라이언스에 대한 사전 검사를 실행합니다.
* 가져오기 프로세스 중에 배포할 NSX 클러스터에 대한 JSON 파일을 만듭니다.
* 필요한 소프트웨어를 SDDC 관리자에 업로드합니다.
* vSphere 클러스터를 VCF VI 워크로드 도메인으로 변환합니다.


변환 프로세스 개요는 다음을 참조하세요. https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/convert-or-import-a-vsphere-environment-into-vmware-cloud-foundation-admin.html["VMware Cloud Foundation에서 vSphere 환경을 관리 도메인으로 변환하거나 vSphere 환경을 VI 워크로드 도메인으로 가져오기"] .



=== vSphere 호스트 및 vCenter 배포

Broadcom 지원 포털에서 다운로드한 ISO를 사용하여 호스트에 vSphere를 배포하거나 vSphere 호스트에 대한 기존 배포 옵션을 사용합니다.

.VM을 호스팅하기 위해 NFS 데이터 저장소를 마운트합니다.
[%collapsible%open]
====
이 단계에서는 NFS 볼륨을 생성하고 이를 VM을 호스팅하기 위한 데이터 저장소로 마운트합니다.

. 시스템 관리자를 사용하여 볼륨을 생성하고 vSphere 호스트의 IP 서브넷을 포함하는 내보내기 정책에 연결합니다.image:vmw-vcf-vmsc-viwld-mcc-003.png["System Manager를 사용한 NFS 볼륨 생성"]
. vSphere 호스트에 SSH를 실행하고 NFS 데이터스토어를 마운트합니다.


[listing]
----
esxcli storage nfs add -c 4 -H 10.192.164.225 -s /WLD01_DS01 -v DS01
esxcli storage nfs add -c 4 -H 10.192.164.230 -s /WLD01_DS02 -v DS02
esxcli storage nfs list
----
[참고] 하드웨어 가속이 지원되지 않는 것으로 표시되는 경우 최신 NFS VAAI 구성 요소( NetApp 지원 포털에서 다운로드)가 vSphere 호스트에 설치되어 있는지 확인하십시오.image:vmw-vcf-vmsc-mgmt-mcc-005.png["NFS VAAI 구성 요소 설치"] 그리고 볼륨을 호스팅하는 SVM에서 vStorage가 활성화됩니다. image:vmw-vcf-vmsc-mgmt-mcc-004.png["VAAI를 위해 SVM에서 vStorage 활성화"] .  추가 데이터 저장소가 필요한 경우 위의 단계를 반복하고 하드웨어 가속이 지원되는지 확인하세요.image:vmw-vcf-vmsc-viwld-mcc-002.png["데이터 저장소 목록.  각 단층 도메인에서 하나씩"]

====
NFS 데이터스토어에 vCenter를 배포합니다.  vCenter 어플라이언스에서 SSH 및 Bash 셸이 활성화되어 있는지 확인하세요.image:vmw-vcf-vmsc-viwld-mcc-004.png["VCF 변환 전"]



=== vSphere 클러스터 생성

. vSphere 웹 클라이언트에 로그인하고 NFS VAAI가 배포된 호스트 중 하나를 추가하여 데이터 센터와 vSphere 클러스터를 만듭니다.  우리는 클러스터의 모든 호스트를 단일 이미지 옵션으로 관리하기로 결정했습니다.  [팁] 클러스터 수준에서 구성 관리를 선택하지 마세요.  추가 세부 사항은 다음을 참조하세요. https://knowledge.broadcom.com/external/article/373968/vlcm-config-manager-is-enabled-on-this-c.html["vSphere 클러스터에 대한 NSX 고려 사항"] .  ONTAP MetroCluster 사용한 vMSC 모범 사례는 다음을 확인하세요. https://docs.netapp.com/us-en/ontap-apps-dbs/vmware/vmware_vmsc_design.html#netapp-storage-configuration["vMSC 설계 및 구현 지침"]
. 클러스터에 다른 vSphere 호스트를 추가합니다.
. 분산 스위치를 생성하고 포트 그룹을 추가합니다.
. https://techdocs.broadcom.com/us/en/vmware-cis/vsan/vsan/8-0/vsan-network-design/migrating-from-standard-to-distributed-vswitch.html["표준 vSwitch에서 분산 스위치로 네트워킹을 마이그레이션합니다."]




=== vSphere 환경을 VCF VI 워크로드 도메인으로 변환

다음 섹션에서는 SDDC 관리자를 배포하고 vSphere 8 클러스터를 VCF 5.2 관리 도메인으로 변환하는 단계를 설명합니다.  필요한 경우, 추가 세부 정보는 VMware 문서를 참조하세요.

Broadcom의 VMware에서 제공하는 VCF 가져오기 도구는 vCenter 어플라이언스와 SDDC 관리자 모두에서 구성을 검증하고 vSphere 및 VCF 환경에 대한 변환 및 가져오기 서비스를 제공하는 유틸리티입니다.

자세한 내용은 다음을 참조하세요.  https://docs.vmware.com/en/VMware-Cloud-Foundation/5.2/vcf-admin/GUID-44CBCB85-C001-41B2-BBB4-E71928B8D955.html["VCF 가져오기 도구 옵션 및 매개변수"] .

.VCF 가져오기 도구 복사 및 추출
[%collapsible%open]
====
VCF 가져오기 도구는 vCenter 어플라이언스에서 vSphere 클러스터가 VCF 변환 또는 가져오기 프로세스에 적합한지 확인하는 데 사용됩니다.

다음 단계를 완료하세요.

. 다음 단계를 따르세요 https://docs.vmware.com/en/VMware-Cloud-Foundation/5.2/vcf-admin/GUID-6ACE3794-BF52-4923-9FA2-2338E774B7CB.html["VCF 가져오기 도구를 대상 vCenter Appliance에 복사합니다."] VMware Docs에서 VCF 가져오기 도구를 올바른 위치로 복사하세요.
. 다음 명령을 사용하여 번들을 추출합니다.
+
....
tar -xvf vcf-brownfield-import-<buildnumber>.tar.gz
....


====
.vCenter 어플라이언스 검증
[%collapsible%open]
====
VI 워크로드 도메인으로 가져오기 전에 VCF 가져오기 도구를 사용하여 vCenter 어플라이언스를 검증합니다.

. 다음 단계를 따르세요 https://docs.vmware.com/en/VMware-Cloud-Foundation/5.2/vcf-admin/GUID-AC6BF714-E0DB-4ADE-A884-DBDD7D6473BB.html["변환 전 대상 vCenter에서 사전 검사 실행"] 검증을 실행하려면.


====
.NSX 배포를 위한 JSON 파일 생성
[%collapsible%open]
====
vSphere 환경을 VMware Cloud Foundation으로 가져오거나 변환하는 동안 NSX Manager를 배포하려면 NSX 배포 사양을 만듭니다.  NSX 배포에는 최소 3개의 호스트가 필요합니다.


NOTE: 변환 또는 가져오기 작업에서 NSX Manager 클러스터를 배포하는 경우 NSX VLAN 지원 세그먼트가 사용됩니다.  NSX-VLAN 지원 세그먼트의 제한 사항에 대한 자세한 내용은 "기존 vSphere 환경을 VMware Cloud Foundation으로 변환하거나 가져오기 전 고려 사항" 섹션을 참조하세요.  NSX-VLAN 네트워킹 제한 사항에 대한 정보는 다음을 참조하세요. https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf-admin.html["기존 vSphere 환경을 VMware Cloud Foundation으로 변환하거나 가져오기 전 고려 사항"] .

다음은 NSX 배포를 위한 JSON 파일의 예입니다.

....
{
  "deploy_without_license_keys": true,
  "form_factor": "small",
  "admin_password": "****************",
  "install_bundle_path": "/nfs/vmware/vcf/nfs-mount/bundle/bundle-133764.zip",
  "cluster_ip": "10.61.185.105",
  "cluster_fqdn": "mcc-wld01-nsx.sddc.netapp.com",
  "manager_specs": [{
    "fqdn": "mcc-wld01-nsxa.sddc.netapp.com",
    "name": "mcc-wld01-nsxa",
    "ip_address": "10.61.185.106",
    "gateway": "10.61.185.1",
    "subnet_mask": "255.255.255.0"
  },
  {
    "fqdn": "mcc-wld01-nsxb.sddc.netapp.com",
    "name": "mcc-wld01-nsxb",
    "ip_address": "10.61.185.107",
    "gateway": "10.61.185.1",
    "subnet_mask": "255.255.255.0"
  },
  {
    "fqdn": "mcc-wld01-nsxc.sddc.netapp.com",
    "name": "mcc-wld01-nsxc",
    "ip_address": "10.61.185.108",
    "gateway": "10.61.185.1",
    "subnet_mask": "255.255.255.0"
  }]
}
....
SDDC 관리자의 vcf 사용자 홈 폴더에 JSON 파일을 복사합니다.

====
.SDDC 관리자에 소프트웨어 업로드
[%collapsible%open]
====
VCF 가져오기 도구를 vcf 사용자의 홈 폴더로 복사하고 NSX 배포 번들을 SDDC 관리자의 /nfs/vmware/vcf/nfs-mount/bundle/ 폴더로 복사합니다.

보다 https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/convert-or-import-a-vsphere-environment-into-vmware-cloud-foundation-admin/seed-software-on-sddc-manager-admin.html["SDDC 관리자 어플라이언스에 필요한 소프트웨어 업로드"] 자세한 지침은 여기를 참조하세요.

====
.변환 전 vCenter에 대한 자세한 확인
[%collapsible%open]
====
관리 도메인 변환 작업이나 VI 워크로드 도메인 가져오기 작업을 수행하기 전에 기존 vSphere 환경의 구성이 변환 또는 가져오기에 지원되는지 확인하기 위해 자세한 검사를 수행해야 합니다. .  SDDC 관리자 어플라이언스에 사용자 vcf로 SSH를 실행합니다. .  VCF 가져오기 도구를 복사한 디렉토리로 이동합니다. .  다음 명령을 실행하여 vSphere 환경을 변환할 수 있는지 확인하세요.

....
python3 vcf_brownfield.py check --vcenter '<vcenter-fqdn>' --sso-user '<sso-user>' --sso-password '********' --local-admin-password '****************' --accept-trust
....
image:vmw-vcf-vmsc-viwld-mcc-008.png["VCF 체크 VC"]

====
.vSphere 클러스터를 VCF VI 워크로드 도메인으로 변환
[%collapsible%open]
====
VCF 가져오기 도구는 변환 과정을 수행하는 데 사용됩니다.

다음 명령은 vSphere 클러스터를 VCF 관리 도메인으로 변환하고 NSX 클러스터를 배포하기 위해 실행됩니다.

....
python3 vcf_brownfield.py import --vcenter '<vcenter-fqdn>' --sso-user '<sso-user>' --sso-password '******' --vcenter-root-password '********' --local-admin-password '****************' --backup-password '****************' --domain-name '<Mgmt-domain-name>' --accept-trust --nsx-deployment-spec-path /home/vcf/nsx.json
....
vSphere 호스트에 여러 개의 데이터스토어가 있는 경우에도 어떤 데이터스토어를 기본 데이터스토어로 간주해야 하는지 묻지 않습니다.

전체 지침은 다음을 참조하세요. https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/convert-or-import-a-vsphere-environment-into-vmware-cloud-foundation-admin.html["VCF 변환 절차"] .

NSX VM은 vCenter에 배포됩니다.image:vmw-vcf-vmsc-viwld-mcc-005.png["VCF 변환 후"]

SDDC 관리자는 제공된 이름으로 생성된 VI 워크로드 도메인과 데이터 저장소로 NFS를 표시합니다.image:vmw-vcf-vmsc-viwld-mcc-006.png["NFS를 사용한 VCF 도메인"]

클러스터를 검사하면 NFS 데이터 저장소에 대한 정보가 제공됩니다.image:vmw-vcf-vmsc-viwld-mcc-007.png["VCF의 NFS 데이터 저장소 세부 정보"]

====
.VCF에 라이선싱 추가
[%collapsible%open]
====
변환을 완료한 후에는 환경에 라이선스를 추가해야 합니다.

. SDDC 관리자 UI에 로그인합니다.
. 탐색 창에서 *관리 > 라이선싱*으로 이동합니다.
. *+ 라이선스 키*를 클릭하세요.
. 드롭다운 메뉴에서 제품을 선택하세요.
. 라이센스 키를 입력하세요.
. 라이센스에 대한 설명을 제공하세요.
. *추가*를 클릭하세요.
. 각 라이선스에 대해 이 단계를 반복합니다.


====