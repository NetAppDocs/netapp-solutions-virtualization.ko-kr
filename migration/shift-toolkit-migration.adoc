---
sidebar: sidebar 
permalink: migration/shift-toolkit-migration.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary:  
---
= Shift Toolkit을 사용하여 VM 마이그레이션
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Shift Toolkit을 사용하여 VMware ESXi에서 Microsoft Hyper-V로 VM을 마이그레이션하세요. 이 프로세스에는 VM 준비, 디스크 형식 변환, 대상 환경의 네트워크 설정 구성이 포함됩니다.



== 이주

청사진이 생성되면 "마이그레이션" 옵션을 실행할 수 있습니다.  마이그레이션 옵션 중에 Shift Toolkit은 일련의 단계를 수행하여 디스크 형식을 변환하고 변환된 디스크를 사용하여 블루프린트에 정의된 대로 Hyper-V 호스트에 가상 머신을 생성합니다.

수행되는 주요 단계는 다음과 같습니다.

필수 조건: 마이그레이션을 시작하기 전에 가상 머신(VM)의 전원이 정상적으로 꺼졌는지 확인하세요. 이는 마이그레이션이 임시 마이그레이션이든 계획된 유지 관리 시간에 따라 예약된 마이그레이션이든 마찬가지입니다.  VM이 완전히 종료되었는지 확인하세요. 운영 체제에 업데이트가 보류 중인 경우 VM이 완전히 종료된 후에만 마이그레이션을 트리거하세요.

* 블루프린트의 모든 VM에 대한 기존 스냅샷을 삭제합니다.
* Blueprint에 대한 VM 스냅샷 트리거 - 소스에서
* 디스크 변환 전 볼륨 스냅샷 트리거
* 모든 VM에 대해 VMDK를 VHDx 형식으로 복제하고 변환합니다.
* 보호 그룹의 VM 전원 켜기 - 대상
* 각 VM에 네트워크를 등록합니다.
* VMware 도구를 제거하고 OS 유형에 따라 트리거 스크립트나 Cron 작업을 사용하여 IP 주소를 할당합니다.




=== 고려해야 할 요소

마이그레이션을 시작하기 전에 모든 전제 조건이 충족되었는지 확인하세요(이 문서의 전제 조건 섹션에서 자세히 설명).  간단히 요약해 보면 다음과 같습니다.

* Shift VM이 도메인의 일부인지 확인하세요.
* CIFS 공유가 적절한 권한으로 구성되었는지 확인하세요.
* 마이그레이션이나 변환에 사용되는 qtree에는 올바른 보안 스타일이 있습니다.
* 빠른 테스트로, 클러스터 내의 Hyper-V 호스트에서 Hyper-V 관리자를 사용하여 VM을 만들고 VHDX를 CIFS 공유(a 항목 참조)에 배치해 보세요.  "프로그램 및 기능"을 통해 또는 "PowerShell"을 사용하여 Hyper-V 관리 도구를 추가하여 Shift 툴킷 VM에서도 동일한 작업을 시도해 보세요. - add-windowsfeature rsat-hyper-v-tools



NOTE: 실패가 있으면,link:https://learn.microsoft.com/en-us/windows-server/virtualization/hyper-v/manage/remotely-manage-hyper-v-hosts["모든 인증 프로토콜을 사용하여 위임을 활성화합니다."] .



=== 네트워크 팁 및 고려 사항

다음과 같은 네트워크 고려사항을 고려해야 합니다.

* 정적 IP 주소가 사용 가능하고 다른 VM에 할당되지 않았는지 확인하세요.


Windows VM의 경우:

* 준비 스크립트는 네트워크 구성 세부 정보(IP 주소 공간, 게이트웨이 주소, DNS 서버)의 사본을 만들고, 트리거 스크립트(마이그레이션 중)는 블루프린트 매핑을 기반으로 단일 NIC이든 여러 NIC이든 네트워크 설정을 다시 적용합니다.
* 마이그레이션 후에도 Windows 장치 관리자에는 마이그레이션 이전의 네트워크 어댑터 정보가 계속 표시될 수 있습니다.  이는 마이그레이션 후 생성된 새 네트워크 어댑터에 영향을 미치지 않으며 IP 충돌을 일으키지 않지만, 스크립트는 현재 이 이전 등록을 삭제하지 않으므로 계속 표시됩니다.


Linux VM의 경우:

* 준비 스크립트는 네트워크 구성 세부 정보(IP 주소 공간, 경로, DNS 서버, 네트워크 장치 이름)의 사본을 만들고 Linux 배포판에 따라 사용된 네트워킹 유형을 식별하여 IP 설정을 적용합니다.  네트워크 재할당 스크립트는 crontab을 사용하여 cron 작업으로 설정되고 부팅 시에 실행됩니다.  예를 들어, cronjob은 네트워크 설정을 다시 적용하기 위해 인스턴스에서 스크립트를 실행합니다(마이그레이션 후). 이는 블루프린트 매핑을 기반으로 하는 단일 NIC이든 여러 NIC이든 상관없습니다.
* 특정 시나리오에서는 변환된 Hyper-V VM이 소스 측에 있던 ens192 또는 33 대신 eth0 또는 eth1과 같은 인터페이스 이름을 갖게 됩니다.  이 경우 스크립트는 새 인터페이스 이름과 일치하도록 네트워크 구성 세부 정보를 업데이트합니다.  예측 가능한 이름(최신 시스템처럼)이 사용 중이고 인터페이스 이름이 Hyper-V 측에 유지되는 경우 스크립트는 네트워크 측을 건너뛰고 VMware 도구만 제거한 다음 VM을 재부팅합니다.
* Shift 툴킷은 현재 NetworkManager, Netplan 및 ifconfig 메커니즘을 지원하고 청사진에 지정된 대로 IP를 유지합니다.




=== 단계 및 옵션

마이그레이션 프로세스의 주요 단계와 옵션은 다음과 같습니다.

. VM 준비 – 마이그레이션을 위해 VM을 준비하고 모든 필수 조건이 완벽하게 완료되었는지 확인합니다.
. 마이그레이션 - 준비가 완료되면 VMware VM을 선택하여 Hyper-V로 마이그레이션합니다. 마이그레이션이 완료되면 VM이 성공적으로 부팅되고 데이터가 제대로 마이그레이션되었는지 확인합니다.
. 테스트 마이그레이션 - 테스트 마이그레이션은 VMDK를 VHDX로 변환하고 SMB 공유에 있는 변환된 VHDX 파일을 사용하여 Hyper-V VM을 만들어 마이그레이션을 시뮬레이션합니다.  테스트 마이그레이션에서는 네트워크 매핑 구성을 허용하지 않습니다. 이 작업은 일반적으로 버블 네트워크에 수동으로 수행해야 합니다.
. 마이그레이션 재시도 – 마이그레이션이 실패하면 Shift 툴킷은 재시도 옵션을 제공합니다.  이 기능을 사용하면 마이그레이션 작업을 실패 지점에서부터 다시 시작할 수 있습니다.  작업을 다시 시도하기 전에 오류 메시지를 검토하여 수정하는 것이 중요합니다.



NOTE: Shift 툴킷은 VM 준비에 필요한 스크립트를 복사하는 것을 제외하고는 소스 VM을 변경하지 않습니다.  이를 통해 변환에 실패할 경우 신속하게 롤백할 수 있습니다.

블루프린트에 지정된 구성으로 마이그레이션 워크플로를 트리거하려면 마이그레이션을 클릭합니다.

image:shift-toolkit-050.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

워크플로가 시작되면 활성화되고 변환 프로세스는 설명된 단계에 따라 VM을 등록합니다.  블루프린트 내의 VM이 전원이 꺼져 있지 않으면 Shift 툴킷은 진행하기 전에 정상적으로 종료할지 묻습니다.

image:shift-toolkit-051.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]


NOTE: 동일한 ESXi 소스에서 동일한 Hyper-V 대상으로 최대 10개의 변환이 병렬로 트리거되지 않도록 권장합니다.

image:shift-toolkit-052.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

VMDK를 VHDx로 변환하는 작업은 몇 초 만에 완료되므로, 추가 비용을 내고 이용할 수 있는 모든 옵션 중에서 가장 빠른 방법입니다.  이는 또한 마이그레이션 중 VM 가동 중지 시간을 줄이는 데 도움이 됩니다.

image:shift-toolkit-053.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

작업이 완료되면 청사진 상태가 "마이그레이션 완료"로 변경됩니다.

image:shift-toolkit-054.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

마이그레이션이 완료되면 Hyper-V 측에서 VM을 검증할 차례입니다.  아래 스크린샷은 블루프린트 생성 중에 지정된 Hyper-V 호스트에서 실행되는 VM을 보여줍니다.

image:shift-toolkit-055.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]


NOTE: Shift 툴킷은 부팅 시 실행되는 cron 작업을 사용합니다.  Hyper-V 호스트에서 VM을 구매한 후에는 Linux 기반 VM에 대한 ssh 연결이나 동등한 연결이 생성되지 않습니다.

image:shift-toolkit-056.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]


NOTE: Windows VM의 경우 Shift Toolkit은 PowerShell 직접을 사용하여 이러한 Windows 기반 게스트 VM에 연결합니다.  PowerShell Direct를 사용하면 네트워크 구성이나 원격 관리 설정에 관계없이 Windows 기반 게스트 VM에 연결할 수 있습니다.


NOTE: 변환 후에는 OS 디스크를 제외한 Windows OS의 모든 VM 디스크가 오프라인이 됩니다.  이는 VMware VM에서 NewDiskPolicy 매개변수가 기본적으로 offlineALL로 설정되어 있기 때문입니다.  이 문제는 기본 Microsoft Windows SAN 정책으로 인해 발생합니다.  이 정책은 여러 서버에서 LUN에 액세스하는 경우 Windows Server를 부팅할 때 LUN이 활성화되는 것을 방지하도록 설계되었습니다.  이는 잠재적인 데이터 손상 문제를 방지하기 위해 수행됩니다.  PowerShell 명령을 실행하면 이를 처리할 수 있습니다: Set-StorageSetting -NewDiskPolicy OnlineAll


NOTE: VM을 스테이징하기 위해 여러 볼륨을 활용합니다. 즉, 필요에 따라 VM을 다른 볼륨으로 스테이징해야 합니다.  리소스 그룹에 대용량 VMDK가 있는 VM이 포함된 경우 변환을 위해 이를 여러 볼륨으로 분산합니다.  이 접근 방식은 복제 분할이 백그라운드에서 진행되는 동안 별도의 볼륨에서 병렬로 복제 작업을 실행하여 스냅샷 작업 중 오류를 방지하는 데 도움이 됩니다.
