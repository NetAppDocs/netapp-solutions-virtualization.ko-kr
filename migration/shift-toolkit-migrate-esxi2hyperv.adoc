---
sidebar: sidebar 
permalink: migration/shift-toolkit-migrate-esxi2hyperv.html 
keywords: netapp, vmware, esxi, vm, migration, virtualization, hyper-v, microsoft 
summary: Shift Toolkit을 사용하여 VM을 준비하고, 디스크 형식을 변환하고, 대상 환경을 구성하여 VMware ESXi에서 Microsoft Hyper-V로 VM을 마이그레이션합니다. 
---
= Shift Toolkit을 사용하여 VMware ESXi에서 Microsoft Hyper-V로 VM 마이그레이션
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Shift Toolkit을 사용하여 VM을 준비하고, 디스크 형식을 변환하고, 대상 환경을 구성하여 VMware ESXi에서 Microsoft Hyper-V로 VM을 마이그레이션합니다.

Shift Toolkit은 대상 환경에서 디스크 포맷 변환과 네트워크 재구성을 통해 가상화 플랫폼 간에 VM 마이그레이션을 가능하게 합니다.



== 시작하기 전에

마이그레이션을 시작하기 전에 다음 전제 조건이 충족되는지 확인하세요.

.Hyper-V 요구 사항
* 독립 실행형 호스트 또는 장애 조치 클러스터로 구성된 Hyper-V 호스트
* 관리자 권한이 있는 Hyper-V 사용자 계정
* Hyper-V 호스트는 최신 DNS 항목을 사용하여 네트워크에 접속할 수 있습니다.
* 적절한 트렁킹으로 구성된 가상 스위치
* 네트워크 선택을 위한 가상 스위치 유형 "외부"
* 동일한 볼륨에 있는 NFS 공유(변환될 VM용) 및 대상 공유(변환된 VM용)
* SMB 제한 위임은 다음을 사용하여 구성되었습니다. `Enable-SmbDelegation` 접근 거부 오류를 방지하려면
* SMB 3.0 활성화됨(기본값)
* SMB 주식에 대해 지속적으로 사용 가능한 자산이 활성화되었습니다.
* 스토리지 가상 머신(SVM)에서 SMB에 대한 내보내기 정책이 비활성화되었습니다.
+

NOTE: SCVMM은 현재 릴리스에서 마이그레이션을 지원하는 엔드포인트가 아닙니다.

* Hyper-V FCI 및 호스트 검색은 DNS 확인에 의존합니다. Shift Toolkit VM에서 호스트 이름을 확인할 수 있는지 확인하세요.  해결에 실패하면 호스트 파일을 업데이트하세요.(`C:\Windows\System32\drivers\etc\hosts` )을 클릭하고 검색 작업을 다시 시도하세요.


.VMware 요구 사항
* VM VMDK는 NFSv3 볼륨에 배치됩니다(지정된 VM에 대한 모든 VMDK는 동일한 볼륨의 일부여야 함)
* VMware 도구는 게스트 VM에서 실행됩니다.
* 마이그레이션할 VM은 준비를 위해 RUNNING 상태입니다.
* 마이그레이션을 트리거하기 전에 VM의 전원을 꺼야 합니다.
* VMware 도구 제거는 VM이 전원이 켜지면 대상 하이퍼바이저에서 수행됩니다.


.게스트 VM 요구 사항
* Windows VM의 경우: 로컬 관리자 자격 증명을 사용하세요(도메인 자격 증명도 사용할 수 있지만 변환하기 전에 VM에 사용자 프로필이 있는지 확인하세요)
* Linux VM의 경우: 암호 프롬프트 없이 sudo 명령을 실행할 수 있는 권한이 있는 사용자를 사용합니다(사용자는 sudoers 목록에 있거나 추가되어야 함). `/etc/sudoers.d/` 접는 사람)




== 1단계: 대상 사이트 추가(Hyper-V)

Shift Toolkit에 대상 Hyper-V 환경을 추가합니다.

.단계
. *새 사이트 추가*를 클릭하고 *대상*을 선택하세요.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-307.png[목적지 사이트 추가]

====
. 목적지 사이트 세부 정보를 입력하세요:
+
** *사이트 이름*: 사이트 이름을 입력하세요
** *하이퍼바이저*: 대상으로 Hyper-V를 선택하세요
** *사이트 위치*: 기본 옵션을 선택하세요
** *커넥터*: 기본 선택을 선택하세요


. *계속*을 클릭하세요.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-308.png[목적지 사이트 세부 정보]

====
. 대상 Hyper-V 세부 정보를 입력하세요.
+
** *Hyper-V 독립 실행형 또는 장애 조치 클러스터 관리자*: IP 주소 또는 FQDN
** *사용자 이름*: 액세스할 사용자 이름(UPN 형식: username@domain.com 또는 domain\administrator)
** *비밀번호*: 리소스 인벤토리를 수행하기 위해 Hyper-V 호스트 또는 FCI 인스턴스에 액세스하기 위한 비밀번호


. *자체 서명된 인증서 수락*을 선택하고 *계속*을 클릭합니다.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-309.png[Hyper-V 세부 정보]

====
. *사이트 만들기*를 클릭하세요.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-310.png[사이트 만들기]

====
+

NOTE: 디스크 포맷 변환은 볼륨 수준에서 동일한 볼륨 내에서 발생하므로 소스 및 대상 저장 시스템은 동일해야 합니다.





== 2단계: 리소스 그룹 만들기

부팅 순서와 부팅 지연 구성을 보존하기 위해 VM을 리소스 그룹으로 구성합니다.

.시작하기 전에
* 필수 구성 요소에 지정된 대로 Qtree가 프로비저닝되었는지 확인하십시오.
* 변환하기 전에 새로 생성된 ONTAP SVM의 지정된 데이터 저장소로 VM을 이동하여 스테이징 영역에서 프로덕션 NFS 데이터 저장소를 분리합니다.


.단계
. *리소스 그룹*으로 이동하여 *새 리소스 그룹 만들기*를 클릭합니다.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-311.png[새 리소스 그룹 만들기]

====
. 드롭다운에서 *소스 사이트*를 선택하고 *만들기*를 클릭합니다.
. 리소스 그룹 세부 정보를 제공하고 워크플로를 선택합니다.
+
** *복제 기반 마이그레이션*: 소스 하이퍼바이저에서 대상 하이퍼바이저로 종단 간 마이그레이션을 수행합니다.
** *클론 기반 변환*: 디스크 형식을 선택한 하이퍼바이저 유형으로 변환합니다.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-312.png[리소스 그룹 세부 정보]

====


. *계속*을 클릭하세요.
. 검색 옵션을 사용하여 VM을 선택합니다(기본 필터는 "데이터 저장소"입니다).
+

NOTE: 데이터 저장소 드롭다운에는 NFSv3 데이터 저장소만 표시됩니다.  NFSv4 데이터 저장소는 표시되지 않습니다.

+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-313.png[VM 선택]

====
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-314.png[데이터 저장소 필터]

====
. 마이그레이션 세부 정보 업데이트:
+
** *목적지* 선택
** *대상 Hyper-V 항목*을 선택하세요
** Datastore에서 Qtree로의 매핑 구성
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-315.png[마이그레이션 세부 정보]

====
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-316.png[Qtree 매핑]

====
+

NOTE: ESXi에서 Hyper-V로 VM을 변환할 때 대상 경로(변환된 VM이 저장되는 경로)가 Qtree로 설정되어 있는지 확인하십시오. 변환된 VM 디스크를 저장하는 데 여러 개의 Qtree를 생성하여 사용할 수 있습니다.



. 선택한 모든 VM에 대한 부팅 순서와 부팅 지연을 구성합니다.
+
** *1*: 전원을 켜는 첫 번째 VM
** *3*: 기본값
** *5*: 마지막으로 전원이 켜진 VM
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-317.png[부팅 순서 구성]

====


. *리소스 그룹 만들기*를 클릭합니다.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-318.png[리소스 그룹 만들기]

====


.결과
리소스 그룹이 생성되어 블루프린트 구성을 위한 준비가 되었습니다.



== 3단계: 마이그레이션 청사진 만들기

플랫폼 매핑, 네트워크 구성, VM 설정을 포함하여 마이그레이션 계획을 정의하는 청사진을 만듭니다.

.단계
. *청사진*으로 이동하여 *새 청사진 만들기*를 클릭합니다.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-319.png[새로운 청사진 만들기]

====
. 청사진의 이름을 제공하고 호스트 매핑을 구성합니다.
+
** *소스 사이트* 및 관련 vCenter 선택
** *대상 사이트* 및 관련 Hyper-V 대상을 선택합니다.
** 클러스터 및 호스트 매핑 구성
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-320.png[호스트 매핑]

====


. 리소스 그룹 세부 정보를 선택하고 *계속*을 클릭합니다.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-321.png[리소스 그룹 세부 정보]

====
. 여러 그룹이 있는 경우 리소스 그룹에 대한 실행 순서를 설정합니다.
. 적절한 가상 스위치에 대한 네트워크 매핑을 구성합니다.
+

NOTE: 가상 스위치는 Hyper-V에 이미 프로비저닝되어 있어야 합니다. Hyper-V 측에서는 네트워크 선택 시 "외부" 가상 스위치 유형만 지원됩니다.  테스트 마이그레이션의 경우, 프로덕션 네트워크 충돌을 피하기 위해 "네트워크를 구성하지 않음"을 선택하세요. 변환 후 네트워크 설정을 수동으로 지정하세요.

+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-322.png[네트워크 매핑]

====
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-323.png[네트워크 구성 옵션]

====
. 스토리지 매핑을 검토합니다(VM 선택에 따라 자동으로 선택됨).
+

NOTE: 사전에 qtree가 프로비저닝되어 있고 필요한 권한이 할당되어 SMB 공유에서 가상 머신을 만들고 전원을 켤 수 있는지 확인하세요.

. 필요한 경우 prepareVM 재정의 옵션을 구성합니다.  이 옵션은 Shift Toolkit을 사용하여 VM 준비를 건너뛰고 대신 사용자 정의 스크립트를 사용하여 해당 작업을 수행해야 할 때 유용합니다.  또한 특정 환경 요구 사항을 충족하도록 IP 주소를 사용자 정의할 수도 있습니다.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-324.png[PrepareVM 재정의]

====
. VM 세부 정보에서 구성 세부 정보를 선택하고 각 OS 유형에 대한 서비스 계정 자격 증명을 제공합니다.
+
** *Windows*: 로컬 관리자 권한이 있는 사용자를 사용하세요(도메인 자격 증명도 사용할 수 있지만 변환하기 전에 VM에 사용자 프로필이 있는지 확인하세요)
** *Linux*: 암호 프롬프트 없이 sudo 명령을 실행할 수 있는 사용자를 사용합니다(사용자는 sudoers 목록에 있거나 추가되어야 함). `/etc/sudoers.d/` 접는 사람)
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-325.png[VM 자격 증명]

====


. IP 설정 구성:
+
** *구성하지 마세요*: 기본 옵션
** *IP 유지*: 소스 시스템의 동일한 IP 유지
** *DHCP*: 대상 VM에 DHCP를 할당합니다.
+
prepareVM 단계에서 VM의 전원이 켜져 있는지, VMware Tools가 설치되어 있는지, 준비 스크립트가 적절한 권한으로 실행되는지 확인하세요.



. VM 설정 구성:
+
** CPU/RAM 매개변수 크기 조정(선택 사항)
** 부팅 순서 및 부팅 지연 수정
** *전원 켜기*: 마이그레이션 후 VM 전원을 켜도록 선택합니다(기본값: 켜짐)
** *VMware Tools 제거*: 변환 후 VMware Tools 제거(기본값: 선택됨)
** *VM 펌웨어*: Gen1 > BIOS 및 Gen2 > EFI(자동)
** *MAC 유지*: 라이선스 요구 사항을 위해 MAC 주소를 유지합니다.
** *서비스 계정 재정의*: 필요한 경우 별도의 서비스 계정을 지정하세요.
** *VLAN 재정의*: 대상 하이퍼바이저가 다른 VLAN 이름을 사용하는 경우 올바른 태그가 지정된 VLAN 이름을 선택합니다.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-326.png[VM 구성]

====


. *계속*을 클릭하세요.
. 날짜와 시간을 선택하여 마이그레이션을 예약하세요.
+

NOTE: VM 준비 시간을 확보하기 위해 최소 30분 전에 마이그레이션 일정을 예약하세요.

+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-327.png[마이그레이션 일정]

====
. *청사진 만들기*를 클릭하세요.


.결과
Shift Toolkit은 소스 VM에서 스크립트를 실행하여 마이그레이션을 준비하는 prepareVM 작업을 시작합니다.

.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-328.png[PrepareVM 작업]

====
준비 과정:

* 드라이버(RHEL/CentOS, Alma Linux)를 추가하고 VMware 도구를 제거하고 IP/경로/DNS 정보를 백업하기 위한 스크립트를 삽입합니다.
* invoke-VMScript를 사용하여 게스트 VM에 연결하고 준비 작업을 실행합니다.
* Windows VM의 경우: 스크립트를 저장합니다. `C:\NetApp`
* Linux VM의 경우: 스크립트를 저장합니다. `/NetApp` 그리고 `/opt`


.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-329.png[Windows 준비 스크립트]

====
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-330.png[Linux 준비 스크립트]

====

NOTE: CentOS 또는 Red Hat을 실행하는 Linux 소스 VM의 경우 Shift Toolkit은 디스크 변환 전에 필요한 Hyper-V 드라이버를 자동으로 설치하여 변환 후 성공적인 부팅을 보장합니다.  자세한 내용은 다음을 참조하세요.link:https://access.redhat.com/solutions/3465011["RHEL VM을 Hyper-V로 마이그레이션한 후 시스템이 Dracut에 갇힘"] .

prepareVM이 성공적으로 완료되면 블루프린트 상태가 "활성"으로 업데이트됩니다.  이제 예약된 시간에 마이그레이션이 진행되거나 *마이그레이션* 옵션을 클릭하여 수동으로 시작할 수 있습니다.

.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-331.png[PrepareVM 완료]

====
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-332.png[활성 청사진]

====


== 4단계: 마이그레이션 실행

VMware ESXi에서 Microsoft Hyper-V로 VM을 변환하기 위한 마이그레이션 워크플로를 트리거합니다.

.시작하기 전에
* 모든 VM은 계획된 유지 관리 일정에 따라 정상적으로 전원이 꺼집니다.
* Shift VM이 도메인의 일부인지 확인하세요.
* CIFS 공유가 적절한 권한으로 구성되었는지 확인하세요.
* 마이그레이션 또는 변환에 사용되는 qtree에는 올바른 보안 스타일이 있습니다.
* 빠른 테스트로 클러스터 내의 모든 Hyper-V 호스트에서 Hyper-V 관리자를 사용하여 VM을 만들고 VHDX를 CIFS 공유에 배치해 보세요.


.단계
. 청사진에서 *마이그레이션*을 클릭합니다.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-333.png[마이그레이션 옵션]

====
. VM의 전원이 꺼지지 않은 경우 Shift Toolkit은 계속 진행하기 전에 정상적으로 종료할지 묻습니다.
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-334.png[종료 프롬프트]

====
. Shift Toolkit은 다음과 같은 작업을 수행합니다.
+
** 블루프린트의 모든 VM에 대한 기존 스냅샷을 삭제합니다.
** 소스에서 VM 스냅샷을 트리거합니다.
** 디스크 변환 전에 볼륨 스냅샷을 트리거합니다.
** 모든 VM에 대해 VMDK를 VHDx 형식으로 변환합니다.
+
변환은 몇 초 만에 완료되므로 가장 빠른 마이그레이션 방식이며 VM 가동 중지 시간도 줄어듭니다.

+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-335.png[마이그레이션 진행 중]

====
+
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-336.png[전환 진행 상황]

====
** 대상에서 VM 전원을 켭니다.
** 각 VM에 네트워크를 등록합니다.
** 트리거 스크립트나 Cron 작업을 사용하여 VMware 도구를 제거하고 IP 주소를 할당합니다.




.결과
작업이 완료되면 청사진 상태가 "마이그레이션 완료"로 변경됩니다.

.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-337.png[마이그레이션 완료]

====
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-338.png[Hyper-V 관리자의 VM]

====
.예를 보여주세요
[%collapsible]
====
image::shift-toolkit-339.png[Hyper-V의 VM 세부 정보]

====

NOTE: 동일한 ESXi 소스에서 동일한 Hyper-V 대상으로 최대 10개의 변환이 병렬로 트리거되어야 합니다.


NOTE: 실패가 있으면,link:https://learn.microsoft.com/en-us/windows-server/virtualization/hyper-v/manage/remotely-manage-hyper-v-hosts["모든 인증 프로토콜을 사용하여 위임을 활성화합니다."] .


NOTE: 마이그레이션 후 Windows VM이 켜지면 Shift Toolkit은 네트워크 구성이나 원격 관리 설정에 관계없이 PowerShell Direct를 사용하여 Windows 기반 게스트 VM에 연결합니다.


NOTE: 변환 후 Windows OS의 모든 VM 디스크는 OS 디스크를 제외하고 오프라인 상태가 됩니다. 이는 VMware VM에서 NewDiskPolicy 매개변수가 기본적으로 offlineALL로 설정되어 있기 때문입니다.  다음 PowerShell 명령을 실행하여 문제를 해결하세요. `Set-StorageSetting -NewDiskPolicy OnlineAll`


NOTE: Shift Toolkit은 Linux 기반 배포판에서 부팅 시 실행되는 cron 작업을 사용합니다.  Linux 기반 VM을 Hyper-V 호스트에 연결하면 SSH 연결이 생성되지 않습니다.



== 비디오 데모

다음 영상에서는 이 솔루션에 설명된 프로세스를 보여줍니다.

.Shift Toolkit을 사용하여 ESXi에서 Hyper-V로 VM 마이그레이션
video::f191dd7d-e4e4-4e5a-9654-b26400f3e9c4[panopto,width=360]